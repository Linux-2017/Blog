<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>systemd | Pursuit Blog&#39;s</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Systemd POST–&amp;gt;Boot Sequence–&amp;gt;Bootloader–&amp;gt;Kernel initramfs(initrd)–&amp;gt;rootfs–&amp;gt;/sbin/init init  Centos 5 : Sysv init  Centos 6 : ">
<meta name="keywords" content="Linux">
<meta property="og:type" content="article">
<meta property="og:title" content="systemd">
<meta property="og:url" content="https://shensir.info/2017/04/08/systemd/index.html">
<meta property="og:site_name" content="Pursuit Blog&#39;s">
<meta property="og:description" content="Systemd POST–&amp;gt;Boot Sequence–&amp;gt;Bootloader–&amp;gt;Kernel initramfs(initrd)–&amp;gt;rootfs–&amp;gt;/sbin/init init  Centos 5 : Sysv init  Centos 6 : Upstart Centos 7 : Systemd     Systemd: 系统启动和服务器守护进程管理器，负责在系">
<meta property="og:updated_time" content="2017-11-19T13:15:37.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="systemd">
<meta name="twitter:description" content="Systemd POST–&amp;gt;Boot Sequence–&amp;gt;Bootloader–&amp;gt;Kernel initramfs(initrd)–&amp;gt;rootfs–&amp;gt;/sbin/init init  Centos 5 : Sysv init  Centos 6 : Upstart Centos 7 : Systemd     Systemd: 系统启动和服务器守护进程管理器，负责在系">
  
    <link rel="alternate" href="/atom.xml" title="Pursuit Blog&#39;s" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Pursuit Blog&#39;s</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://shensir.info"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-systemd" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/08/systemd/" class="article-date">
  <time datetime="2017-04-08T14:22:22.000Z" itemprop="datePublished">2017-04-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      systemd
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Systemd"><a href="#Systemd" class="headerlink" title="Systemd"></a>Systemd</h1><ul>
<li>POST–&gt;Boot Sequence–&gt;Bootloader–&gt;Kernel initramfs(initrd)–&gt;rootfs–&gt;/sbin/init<ul>
<li>init <ul>
<li>Centos 5 : Sysv init </li>
<li>Centos 6 : Upstart</li>
<li>Centos 7 : Systemd</li>
</ul>
</li>
</ul>
</li>
<li>Systemd: 系统启动和服务器守护进程管理器，负责在系统启动或运行时，激活系统资源，服务器进程和其他进程．系统引导时实现服务并行启动，按需启动守护进程，自动化的服务依赖关系管理，同时采用socket式与Ｄ-Bus总线式激活服务，系统状态快照．</li>
</ul>
<h2 id="unit"><a href="#unit" class="headerlink" title="unit"></a>unit</h2><p><strong>unit</strong>表示不同类型的systemd对象，通过配置文件进行标识和配置；文件中主要包含了系统服务，监听socket,保存系统快照以及其他与init相关的信息</p>
<p><strong>配置文件</strong>：</p>
<ul>
<li>/usr/lib/systemd/system: 每个服务最主要的启动脚本设置，类似于之前的/etc/init.d/</li>
<li>/run/systemd/system: 系统执行过程中所产生的服务脚本，比上面目录优先运行</li>
<li>/etc/systemd/system: 管理员建立的执行脚本，类似与/etc/rc.d/rcN.d/sxx类的功能，比上面目录优先运行</li>
</ul>
<p><strong>unit类型</strong></p>
<ul>
<li>Systemctl -t help 查看unit类型</li>
<li>Service unit: 文件扩展名为.service，用于定义系统服务</li>
<li>Target uniq: .device,用于定义内核识别的设备</li>
<li>Ｍount unit: .mount,用于定义文件系统挂载点</li>
<li>Socket unit: .socket,用于标识进程间通信用的socket文件，也可在系统启动时，延迟启动服务，实现按需启动</li>
<li>Snapshot unit: .snapshot,管理系统快照</li>
<li>Swap unit: .swao,用于标识swap设备</li>
<li>Automount unit: .automount,文件系统的自动挂载点</li>
<li>Path unit: .path,用于定义文件系统中的一个文件或目录使用，常用于当文件系统变化时，延迟激活服务，如：spool目录</li>
</ul>
<p><strong>管理服务</strong></p>
<ul>
<li>systemctl start|stop|reload|restart|status name.service</li>
<li>条件式重启: 已启动才重启，否则不做操作: systemctl try-restart name.service</li>
<li>禁止自动和手动启动: Systemctl mask name.service</li>
<li>取消禁止: Systemctl unmask name.service</li>
</ul>
<p><strong>服务查看</strong></p>
<ul>
<li><p>查看某服务当前激活与否的状态</p>
<blockquote>
<p>systemctl is-active name.service</p>
</blockquote>
</li>
<li><p>查看所有已经激活的服务</p>
<blockquote>
<p>systemctl list-unis –type|-t service</p>
</blockquote>
</li>
<li><p>查看所有服务</p>
<blockquote>
<p>systemctl list-units –type service -all|-a</p>
</blockquote>
</li>
<li><p>设定某服务的开机启动</p>
<blockquote>
<p>chkconfig name on ==&gt; systemctl enable name.service</p>
</blockquote>
</li>
<li><p>设定某服务的开机禁止启动</p>
<blockquote>
<p>chkconfig name off ==&gt; systemctl disable name.service</p>
</blockquote>
</li>
<li><p>查看所有的开机自启状态</p>
<blockquote>
<p>chkconfig –list ==&gt; systemctl list-unit-files –type service</p>
</blockquote>
</li>
<li><p>用来列出该服务在哪些运行级别下启用和禁用</p>
<blockquote>
<p>chkconfig sshd -list ==&gt; ls /etc/systemd/system/*.wants/sshd.service</p>
</blockquote>
</li>
<li><p>查看服务是否开机自启</p>
<blockquote>
<p>systemctl is-enabled name.service</p>
</blockquote>
</li>
<li><p>其他命令</p>
<blockquote>
<p>查看服务的依赖关系:</p>
<p>systemctl list-dependencies name.service</p>
</blockquote>
</li>
<li><p>杀掉进程</p>
<blockquote>
<p>systemctl kill 进程名</p>
</blockquote>
</li>
</ul>
<p><strong>服务状态</strong></p>
<ul>
<li>systemctl list-unit-files –type service –all显示状态</li>
<li>loaded: Unit配置文件已处理</li>
<li>active(running) : 一次或多次持续处理的运行</li>
<li>active(exited): 成功完成一次性的配置</li>
<li>active(waiting): 运行中，等待一个事件</li>
<li>inactive: 不运行</li>
<li>enabled: 开机启动</li>
<li>disabled: 开机不启动</li>
<li>static: 开机不启动，但可被另一个启用的服务激活</li>
</ul>
<p><strong>命令示例</strong></p>
<ul>
<li><p>显示所有单元状态</p>
<blockquote>
<p>systemctl 或 systemctl list-units</p>
</blockquote>
</li>
<li><p>只显示服务单元的状态</p>
<blockquote>
<p>systemctl –type=service</p>
</blockquote>
</li>
<li><p>显示sshd服务单元</p>
<blockquote>
<p>systemctl status sshd.service -l</p>
</blockquote>
</li>
<li><p>验证sshd服务当前是否活动</p>
<blockquote>
<p>systemctl is-active sshd</p>
</blockquote>
</li>
<li><p>列出所有服务状态的所有服务单元</p>
<blockquote>
<p>systemctl list-units –type=service </p>
</blockquote>
</li>
<li><p>列出所有服务单元</p>
<blockquote>
<p>systemctl list-units –type=service –all</p>
</blockquote>
</li>
<li><p>查看服务单元的启用和禁用状态</p>
<blockquote>
<p>systemctl list-unit-files –type=service</p>
</blockquote>
</li>
<li><p>列出失败的服务</p>
<blockquote>
<p>systemctl –failed –type=service</p>
</blockquote>
</li>
<li><p>列出依赖的单元</p>
<blockquote>
<p>systemctl listdependencies sshd</p>
</blockquote>
</li>
<li><p>禁用network,使之不能自动启动，但手动可以</p>
<blockquote>
<p>systemctl disable network</p>
</blockquote>
</li>
<li><p>启用network</p>
<blockquote>
<p>systemctl enable network </p>
</blockquote>
</li>
<li><p>禁用network,使之不能手动或自动启动</p>
<blockquote>
<p>systemctl mask network</p>
</blockquote>
</li>
<li><p>启用network</p>
<blockquote>
<p>systemctl unmask network</p>
</blockquote>
</li>
</ul>
<p><strong>运行级别</strong></p>
<ul>
<li><p>target units:</p>
<blockquote>
<p>unit配置文件: .target</p>
<p>ls /usr/lib/systemd/system/*.target</p>
<p>systemctl list-unit-files –type target –all</p>
</blockquote>
</li>
<li><p>运行级别</p>
<blockquote>
<p>0 ==&gt; runlevel0.target,poweroff.target</p>
<p>1 ==&gt; runlevel1.target,recue.target</p>
<p>2 ==&gt; runlevel2.target,multi-user.target</p>
<p>3 ==&gt; runlevel3.target,multi-user.target</p>
<p>4 ==&gt; runlevel4.target,multi-user.target</p>
<p>5 ==&gt; runlevel5.target,graphical.target</p>
<p>6 ==&gt; runlevel6.target,reboot.target</p>
</blockquote>
</li>
<li><p>查看依赖性:</p>
<blockquote>
<p>systemctl list-dependencies graphical.target</p>
</blockquote>
</li>
<li><p>级别切换: init N  ==&gt; systemctl isolate name.target</p>
<p>systemctl isolate multi-user.target</p>
<p>注: 只有/lib/systemd/system/*.target文件中AllowIoslate=yes才能切换(修改文件需执行systemctl daemon-reload才能生效)</p>
</li>
<li><p>查看target;</p>
<p>runlevel ; who -r</p>
<p>systemctl list-units –type target</p>
</li>
<li><p>获取默认运行级别</p>
<p>/etc/initab ==&gt; systemctl get-default</p>
</li>
<li><p>修改默认级别</p>
<p>/etc/initab ==&gt; systemctl set-default name.target</p>
<p>systemctl set-default multi-user.target</p>
<p>ls -l  /etc/systemd/system/default.target</p>
</li>
</ul>
<p><strong>other command</strong></p>
<ul>
<li><p>切换至紧急救援摸索</p>
<blockquote>
<p>systemctl rescue</p>
</blockquote>
</li>
<li><p>切换至emergency模式</p>
<blockquote>
<p>systemctl energebcy</p>
</blockquote>
</li>
<li><p>其他常用命令</p>
<p>传统命令init,poweroff,halt,reboot都成为systemctl的软链接</p>
<blockquote>
<p>关机重启: systemctl halt|poweroff|reboot</p>
<p>挂起: systemctl suspend</p>
<p>休眠: systemctl hibernate</p>
<p>休眠并挂起: systemctl hybrid-sleep</p>
</blockquote>
</li>
</ul>
<p><strong>Centos 7引导顺序</strong></p>
<ul>
<li>UEFI或BIOS初始化，运行POST开机自检</li>
<li>选择启动设备</li>
<li>引导装载程序，centos7是grub2</li>
<li>加载装载程序的配置文件:/etc/grub.d/ /etc/default/grub/ /boot/grub2/grub.cfg</li>
<li>加载initramfs驱动模块</li>
<li>加载内核选项</li>
<li>内核初始化,centos 7使用systemd代替init</li>
<li>执行initrd.target所有单元,包括挂载/etc/fstab</li>
<li>从initramfs根文件系统切换到磁盘跟目录</li>
<li>systemd执行默认target配置,配置文件　/etc/systemd/system/default.target</li>
<li>systemd执行sysinit.target初始化系统及basic.target准备操作系统</li>
<li>systemd启动multi-user.target下的本机与服务器服务</li>
<li>systemd执行multi-user.target下的/etc/rc.d/rd.local</li>
<li>systemd执行mult-user.target下的getty.target及登陆服务</li>
<li>systemd换行graphical需要的服务</li>
</ul>
<p><strong>centos 7口令破解</strong></p>
<ul>
<li>启动时e进入编辑模式</li>
<li>在linux16后添加内核参数rd.break，然后ctrl +x</li>
<li>mount -o remount,rw /sysroot</li>
<li>chroot /sysroot</li>
<li>passwd root</li>
<li>touch /.autorelabel</li>
<li>exit</li>
</ul>
<p><strong>修复grub2</strong></p>
<ul>
<li><p>修复主配置文件</p>
<blockquote>
<p>grub2-mkconfig &gt; /boot/grub2/grub.cfg</p>
</blockquote>
</li>
<li><p>修复grub</p>
<blockquote>
<p>grub2-install /dev/sda bios</p>
<p>grub2-install UEFI</p>
</blockquote>
</li>
<li><p>调整默认启动内核</p>
<blockquote>
<p>vim /etc/default/grub</p>
<p>GRUB_DEFAULT=0</p>
</blockquote>
<p>​</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shensir.info/2017/04/08/systemd/" data-id="cjb07229o001ygezuy6fgh3q5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/04/11/ca/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          ca
        
      </div>
    </a>
  
  
    <a href="/2017/04/08/awk/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">awk</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP-HEADER/">HTTP HEADER</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Haproxy/">Haproxy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Keepalived/">Keepalived</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tomcat/">Tomcat</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ca/">Ca</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fastdfs/">Fastdfs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP-HEADER/">HTTP HEADER</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Haproxy/">Haproxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Http/">Http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Httpd/">Httpd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Https/">Https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Iptables/">Iptables</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Keepalived/">Keepalived</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Maradb/">Maradb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mariadb/">Mariadb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MogileFS/">MogileFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Notes/">Notes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ProxySQL/">ProxySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bind/">bind</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/keepalived/">keepalived</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lvs/">lvs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/modules/">modules</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nfs/">nfs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/session/">session</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/中间件/">中间件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/主从复制/">主从复制</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式文件系统/">分布式文件系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/基础命令/">基础命令</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文件共享/">文件共享</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/负载均衡/">负载均衡</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Ca/" style="font-size: 10px;">Ca</a> <a href="/tags/Fastdfs/" style="font-size: 10px;">Fastdfs</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/HTTP-HEADER/" style="font-size: 10px;">HTTP HEADER</a> <a href="/tags/Haproxy/" style="font-size: 10px;">Haproxy</a> <a href="/tags/Http/" style="font-size: 13.33px;">Http</a> <a href="/tags/Httpd/" style="font-size: 10px;">Httpd</a> <a href="/tags/Https/" style="font-size: 13.33px;">Https</a> <a href="/tags/Iptables/" style="font-size: 10px;">Iptables</a> <a href="/tags/Keepalived/" style="font-size: 10px;">Keepalived</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/Maradb/" style="font-size: 10px;">Maradb</a> <a href="/tags/Mariadb/" style="font-size: 13.33px;">Mariadb</a> <a href="/tags/MogileFS/" style="font-size: 10px;">MogileFS</a> <a href="/tags/Notes/" style="font-size: 13.33px;">Notes</a> <a href="/tags/ProxySQL/" style="font-size: 10px;">ProxySQL</a> <a href="/tags/bind/" style="font-size: 10px;">bind</a> <a href="/tags/keepalived/" style="font-size: 13.33px;">keepalived</a> <a href="/tags/linux/" style="font-size: 16.67px;">linux</a> <a href="/tags/lvs/" style="font-size: 10px;">lvs</a> <a href="/tags/modules/" style="font-size: 10px;">modules</a> <a href="/tags/nfs/" style="font-size: 10px;">nfs</a> <a href="/tags/nginx/" style="font-size: 13.33px;">nginx</a> <a href="/tags/session/" style="font-size: 10px;">session</a> <a href="/tags/web/" style="font-size: 13.33px;">web</a> <a href="/tags/中间件/" style="font-size: 10px;">中间件</a> <a href="/tags/主从复制/" style="font-size: 10px;">主从复制</a> <a href="/tags/分布式文件系统/" style="font-size: 10px;">分布式文件系统</a> <a href="/tags/基础命令/" style="font-size: 10px;">基础命令</a> <a href="/tags/文件共享/" style="font-size: 10px;">文件共享</a> <a href="/tags/负载均衡/" style="font-size: 13.33px;">负载均衡</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/06/12/Fastdfs安装配置/">Fastdfs安装配置</a>
          </li>
        
          <li>
            <a href="/2017/06/12/Maradb主从复制/">Maradb主从复制</a>
          </li>
        
          <li>
            <a href="/2017/06/12/Mariadb半同步复制及复制过滤器/">Mariadb半同步复制及复制过滤器</a>
          </li>
        
          <li>
            <a href="/2017/06/12/MogileFS的安装配置/">MogileFS的安装配置</a>
          </li>
        
          <li>
            <a href="/2017/06/12/Maradb主主复制/">Maradb主主复制</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Pursuit<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>