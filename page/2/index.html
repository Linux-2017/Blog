<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Pursuit Blog&#39;s</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Pursuit Blog&#39;s">
<meta property="og:url" content="https://shensir.info/page/2/index.html">
<meta property="og:site_name" content="Pursuit Blog&#39;s">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Pursuit Blog&#39;s">
  
    <link rel="alternate" href="/atom.xml" title="Pursuit Blog&#39;s" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Pursuit Blog&#39;s</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://shensir.info"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-nginx负载均衡" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/15/nginx负载均衡/" class="article-date">
  <time datetime="2017-05-15T08:20:11.000Z" itemprop="datePublished">2017-05-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/15/nginx负载均衡/">nginx负载均衡</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Nginx负载均衡"><a href="#Nginx负载均衡" class="headerlink" title="Nginx负载均衡"></a>Nginx负载均衡</h3><blockquote>
<h4 id="四层"><a href="#四层" class="headerlink" title="四层"></a>四层</h4></blockquote>
<p><strong>ngx_stream_core_module</strong></p>
<ul>
<li>配置 </li>
</ul>
<pre><code>注释nginx.conf下http上下文(:.,$s/^/#/g)
加入sream
stream {
        upstream webs {
                server 172.18.50.72:80;
                server 172.18.50.73:80;
        }
        server {
                listen 80;
                proxy_pass webs;
}
</code></pre><p><strong>ngx_stream_core_module</strong></p>
<blockquote>
<p>The ngx_stream_proxy_module module (1.9.0) allows proxying data streams over TCP, UDP (1.9.13), and UNIX-domain sockets.</p>
</blockquote>
<ul>
<li>proxy_pass address</li>
</ul>
<blockquote>
<p>Sets the address of a proxied server. The address can be specified as a domain name or IP address, and a port or as a UNIX-domain socket path.    </p>
</blockquote>
<ul>
<li>proxy_timeout timeout;</li>
</ul>
<blockquote>
<p>Sets the timeout between two successive read or write operations on client or proxied server connections. If no data is transmitted within this time, the connection is closed.</p>
</blockquote>
<ul>
<li>proxy_connect_timeout time</li>
</ul>
<blockquote>
<p>设置nginx与被代理的服务器尝试建立连接的超时时长；默认为60s；</p>
</blockquote>
<pre><code>        示例：
            stream {
                upstream sshsrvs {
                    server 192.168.10.130:22;
                    server 192.168.10.131:22;
                    hash $remote_addr consistent;
                }

                server {
                    listen 172.16.100.6:22202;
                    proxy_pass sshsrvs; 
                    proxy_timeout 60s;
                    proxy_connect_timeout 10s;
                }
            }
</code></pre><blockquote>
<h4 id="七层"><a href="#七层" class="headerlink" title="七层"></a>七层</h4></blockquote>
<p><strong>ngx_http_upstream_module</strong></p>
<blockquote>
<p>The ngx_http_upstream_module module is used to define groups of servers that can be referenced by the proxy_pass, fastcgi_pass, uwsgi_pass, scgi_pass, and memcached_pass directives.</p>
</blockquote>
<ul>
<li><p>upstream name {…}</p>
<blockquote>
<p>定义后端服务器组;引入一个新的上下文;只能用于http{}上下文中;</p>
<p>默认的调度方法是wrr;</p>
</blockquote>
</li>
<li><p>server address [parameters]</p>
<blockquote>
<p>定义服务器地址和相关的参数</p>
<p>​    地址格式：</p>
<p>​        IP·[:PORT]</p>
<p>​        HOSTNAME[:PORT]</p>
<p>​        unix:/PATH/TO/SOME_SOCK_FILE</p>
<p>​    参数:weight=number</p>
<p>​            权重，默认为1;</p>
<p>​    max_fails=number</p>
<p>​        失败尝试的最大次数</p>
<p>​    fail_timeout=time</p>
<p>​        设置服务器为不可用状态的超时时长</p>
<p>​    backup</p>
<p>​        把服务器标记为备用状态</p>
<p>​    down</p>
<p>​        手动标记其为不可用</p>
</blockquote>
</li>
<li><p>least_conn</p>
<blockquote>
<p>最少连接调度算法;当server拥有不同的权重时为wlc;当所有后端主机的连接数相同时，则使用wrr进行调度;</p>
</blockquote>
</li>
<li><p>least_time header | last_byte</p>
<blockquote>
<p>最短平均响应时长和最少连接</p>
<p>header:response_header</p>
<p>last_byte:full_response</p>
<p>仅Nginx Plus有效</p>
</blockquote>
</li>
<li><p>ip_hash</p>
<blockquote>
<p>源地址hash算法;能够将来自同一个源ip地址的请求发往同一个upstream server;</p>
</blockquote>
</li>
<li><p>hash key [consistent]</p>
<blockquote>
<p>基于指定的key的has表实现请求调度，此处的key可以文本、变量或二者的组合;</p>
<p>consistent:参数，指定使用一致性hash算法;</p>
<p>实例：</p>
<p>​    hash $request_uri consitent</p>
<p>​    hash $remote_addr</p>
<p>​    hash $cookie_name</p>
</blockquote>
</li>
<li><p>keepalive connections</p>
<blockquote>
<p>可使用长连接的连接数量</p>
</blockquote>
</li>
<li><p>health_check [parameters]</p>
<blockquote>
<p>定义对后端主机的健康检测机制之;只能用于localtion上下文</p>
<p>​    可用参数:</p>
<p>​        interval=time:检测频率，默认为每隔5秒钟;</p>
<p>​        fails=number:判断服务器状态为失败需要检测的次数;</p>
<p>​        passes=number:判断服务器状态转为成功需要检测的次数</p>
<p>​        uri=uri:判断其健康与否使用的uri</p>
<p>​        match=name:基于制定的match来衡量检测结果的成败</p>
<p>​        port=number:使用独立的端口进行检测</p>
<p>​    仅Nginx Plus有效</p>
</blockquote>
</li>
<li><p>match name {…}</p>
<blockquote>
<p>定义衡量某检测结果是否为成功的衡量机制</p>
<p>专用机制：</p>
<p>​    status CODE</p>
<p>​    status !CODE</p>
<p>​    …</p>
<p>​    header:基于响应报文的首部进行判断</p>
<p>​        header HEADER=VALUE</p>
<p>​        header HEADER ~ VALUE</p>
<p>​    body:基于响应保温的内容进行判断</p>
<p>​        body ~ “PATTERN”</p>
<p>​        body !~ “PATTERN”</p>
<p>​    仅Nginx Plusu有效</p>
</blockquote>
</li>
</ul>
<p>示例</p>
<pre><code>vim nginx.conf
worker_processes  1;
events {
    worker_connections  1024;
}
http {
    keepalive_timeout  65;
    include upstream.conf;
} 
vim upstream.conf
upstream debugo_servers {
    server debugo03:80 weight=5;
    server debugo04:80 weight=10;
}
server {
    listen    debugo01:80;
    location / {
        proxy_pass http://debugo_servers;
    }
}
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://shensir.info/2017/05/15/nginx负载均衡/" data-id="cjb07229k001sgezumqpwrilc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/负载均衡/">负载均衡</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Nginx配置及优化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/14/Nginx配置及优化/" class="article-date">
  <time datetime="2017-05-14T07:42:51.000Z" itemprop="datePublished">2017-05-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/14/Nginx配置及优化/">nginx配置及调优</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a><strong>Nginx</strong></h3><h4 id="配置文件的组成部分"><a href="#配置文件的组成部分" class="headerlink" title="配置文件的组成部分"></a>配置文件的组成部分</h4><ul>
<li><p>主配置文件:/nginx.conf</p>
<p>include conf.d/*.conf</p>
</li>
<li><p>fastcgi,uwsgi,scgi等协议相关的配置文件</p>
</li>
<li><p>mime.type:支持的mime类型</p>
</li>
</ul>
<h4 id="主配置文件结构"><a href="#主配置文件结构" class="headerlink" title="主配置文件结构"></a>主配置文件结构</h4><ul>
<li>main block:这里配置影响nginx全局的指令。一般有运行nginx服务器的用户组，nginx进程pid存放路径，日志存放路径，配置文件引入，允许生成worker process数等。</li>
<li>events block:配置影响nginx服务器与用户的网络连接。有每个进程的最大连接数，选取那种事件驱动模型处理连接请求，是否允许同时接受多个网络连接，开启网络连接序列化等。</li>
<li>http block:可以嵌套多个server,配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，mime-type定义，日志自定义，是否使用sendfile传输文件，连接超时时间，但连接请求数等。</li>
<li>server block:配置虚拟主机相关参数</li>
<li>location block:配置请求的路由，以及各种页面的处理情况。</li>
</ul>
<h4 id="配置指令"><a href="#配置指令" class="headerlink" title="配置指令"></a>配置指令</h4><ul>
<li><h6 id="main配置段常见的指令"><a href="#main配置段常见的指令" class="headerlink" title="main配置段常见的指令"></a>main配置段常见的指令</h6><blockquote>
<p>分类</p>
</blockquote>
<ul>
<li>正常运行必备的配置</li>
<li>优化性能相关的配置</li>
<li>用于调试及定位问题相关的配置</li>
<li>事件驱动相关的配置</li>
</ul>
<blockquote>
<p>正常运行必备的配置</p>
</blockquote>
<ul>
<li><p>user</p>
<pre><code>Syntax: user user [group]
Default: user nobody nobody
Centext: main
</code></pre></li>
<li><p>pid /PATH/TO/PID_FILE</p>
<p>​    指定存储nginx主进程进程号码文件路径</p>
</li>
<li><p>include file | mask</p>
<p>​    指明包含进来的其他配置文件片段</p>
</li>
<li><p>load_module file</p>
<p>​    指明要装载的动态模块</p>
</li>
</ul>
<blockquote>
<p>性能优化的相关配置</p>
</blockquote>
<ul>
<li><p>worker_processes number|auto;</p>
<p>​    worker进程的数量;通常应该为当前主机的cpu的物理核心数;</p>
</li>
<li><p>worker_cpu_affinity cpumask …;</p>
<p>​    worker_cpu_affinity auto [cpumask];</p>
<p>​    CPU MASK:</p>
<p>​        0001    0号cpu</p>
<p>​        0010    1号cpu</p>
<p>​        …</p>
</li>
<li><p>worker_priority number</p>
<p>​    指明worker进程的nice值，设定worker进程优先级;[-20,20]</p>
</li>
<li><p>worker_rlimit_nofile number;</p>
<p>​    worker进程所能够打开的文件数量上限</p>
</li>
</ul>
<blockquote>
<p>调试、定位问题</p>
</blockquote>
<ul>
<li><p>daemon on|off</p>
<p>​    是否以守护进程方式运行Nginx</p>
</li>
<li><p>master_process on|off</p>
<p>​    是否以master/worker模型运行nginx;默认为On;</p>
</li>
<li><p>error_log file [level]</p>
</li>
</ul>
<blockquote>
<p>事件驱动相关的配置</p>
</blockquote>
<p>​    events {</p>
<p>​        …</p>
<p>​    }</p>
<ul>
<li><p>worker_connections  * worker_connections</p>
<p>​    每个worker进程所能够打开的最大并发连接数数量</p>
</li>
<li><p>use method</p>
<p>​    指明并发连接请求的处理方法</p>
<p>​    use epoll;</p>
</li>
<li><p>accept_mutex on | off</p>
<p>​    处理新的连接请求的方法;on意味者由各种worker轮流处理新请求,off意味者每个新请求的到达都会通知所有的worker进程</p>
</li>
</ul>
</li>
<li><h6 id="http协议的相关配置"><a href="#http协议的相关配置" class="headerlink" title="http协议的相关配置"></a><strong>http协议的相关配置</strong></h6><ul>
<li><p>配置一个虚拟主机</p>
<pre><code>server {
      listen address[:PORT] | PORT;
      server_name SERVERNAME;
      root /PATH/TO/DOCUMENT_ROOT;
}
</code></pre></li>
<li><p>listen PORT|address[:port]|unix:/PATH/TO/SOCKET_FILE</p>
<p>​    listem address[:port] [default_server]  [ssl]  [http2 | spdy]  [backlog=number]  [rcvbuf=size]  [sndbuf=size]</p>
<p>default_server:设定为默认虚拟主机</p>
<p>ssl:限制仅能够通过ssl连接提供服务</p>
<p>backlog=number:后援队列长度</p>
<p>rvbuf=size:接收缓冲区大小</p>
<p>sndbuf=size:发送缓冲区大小</p>
</li>
<li><p>server_name name …</p>
<p>​    指明虚拟主机的主机名称;后可根多个空白字符分割的字符串</p>
<p>​        支持<em>通配任意长度的任意字符;例如:server_name  </em>.domain.com</p>
<p>​        支持~起始的字符做正则表达式模式匹配;server_name  ~^www\d.domain.com$</p>
<p>匹配机制:</p>
<p>​     字符串精确匹配–&gt;左侧*通配符–&gt;右侧*匹配–&gt;正则表达式</p>
</li>
<li><p>tcp_nodelay on | off</p>
<p>​    在keepalived模式下的连接是否启用TCP——NODELAY选项</p>
</li>
<li><p>sendfile on | off</p>
<p>​    是否启用sendfile功能</p>
</li>
</ul>
<blockquote>
<p>定义路径相关的配置</p>
</blockquote>
<ul>
<li><p>root path</p>
<p>​    设置web资源路径映射;用于指明用户请求的url所对应的本地文件系统上的文档所在目录路径;可用的位置:http,server,location,if in location;</p>
</li>
<li><p>location [ = | ~ | ~* | ^~ | url ] uri {…}</p>
<blockquote>
<p>在一个server中location配置段可存在多个，用于实现从uri到文件系统的路径映射;nginx会根据用户请求URI来检查定义所有location，并找出一个最佳匹配，而后应用其配置;</p>
</blockquote>
<p>=    对URI做精确匹配</p>
<p>~    对URI做正则表达式匹配，区分字符大小写</p>
<p>~*    对URI做正则表达式匹配，不区分字符大小写</p>
<p>^~    对URI的做半部分做匹配检查，不区分字符大小写</p>
<p>不带符号:匹配起始与此uri的所有url;</p>
<p>匹配优先级:</p>
<blockquote>
<p>=    ^~    ~    ~*    不带符号</p>
</blockquote>
</li>
<li><p>alias  path</p>
<blockquote>
<p>定义路径别名，文档映射的另一种机制;仅能用于lacation上下文</p>
</blockquote>
<p><strong>注意:</strong>lacation中使用root指令和alias指令意义不同</p>
<p>​    root:给定的路径对应于location中的/uri左侧的/</p>
<p>​    alias:给定的路径对应于location中的/uri右侧的/</p>
<p>示例:</p>
<pre><code>location /img/ {
    alias /var/www/image/;
}
#若按照上述配置的话，当客户端请求访问/img/目录里面的文件时，ningx会自动去/var/www/image/目录找文件

location /img/ {
    root /var/www/image;
}
#若按照这种配置的话，则访问/img/目录下的文件时，nginx会去/var/www/image/img/目录下找文件.
</code></pre></li>
<li><p>index file …</p>
<p>默认资源;http,server,location</p>
</li>
<li><p>error_page code … [=[response]]  uri</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>try_files file … uri    </p>
<blockquote>
<p>定义客户端请求的相关配置</p>
</blockquote>
<ul>
<li>keepalive_timeout timeout  [header_timeout]</li>
</ul>
<p>​    设定保持连接的超时时长，0表示禁止长连接;默认为75s;</p>
<ul>
<li>keepalive_requests number</li>
</ul>
<p>​    在一次长连接上所允许请求的资源的最大数量，默认为100;</p>
<ul>
<li>keepalive_disable none | browser …;</li>
</ul>
<p>​    对哪种浏览器禁用长连接</p>
<ul>
<li>send_timeout time;</li>
</ul>
<p>​    向客户端发送响应报文的超时时长，此处，是指两次写操作的间隔时长</p>
<ul>
<li>client_body_buffer_size size</li>
</ul>
<p>​    用于接收客户端请求报文的body部分的缓冲区大小;默认为16k;超出此大小时，其将暂存磁盘上由client_body_temp_path指令所定义的位置</p>
<ul>
<li>client_body_temp_path path [level1 [level2  [level3 ]]]</li>
</ul>
<p>​    用于设定存储客户端请求报文的body部分的临时存储路径及目录结构和数量;</p>
<p>​    16进制的数字:</p>
<p>​    client_body_temp_path path  /var/tmp/client_body  2   1   1</p>
<p>​        2： 表示一级子目录为2个16为进制数字，也就是256个</p>
<p>​        1:    表示二级子目录为1个16为进制数字</p>
<p>​        1:    表示三级子目录为1个16为进制数字</p>
<blockquote>
<p>对客户端进制限制的相关配置</p>
</blockquote>
<ul>
<li>limit_rate rate</li>
</ul>
<p>​    限制响应给客户端的传输速率，单位是bytes/second,0表示无限制</p>
<ul>
<li>limit_except method … {…}</li>
</ul>
<p>​    限制对指定的请求方法之外的其他方法的使用客户端;</p>
<p>limit_except GET {</p>
<p>​    allow 172.18.0.0/16;</p>
<p>​    deny all;</p>
<p>}</p>
<blockquote>
<p>文件操作优化</p>
</blockquote>
<ul>
<li>aio on | off | threads[=pool]</li>
</ul>
<p>​    是否启用aio功能</p>
<ul>
<li>directio size | off</li>
</ul>
<p>​    在Linux主机启用O_DIRECT标记，此处意味文件大于等于给定的大小时使用，例如directio 4m;</p>
<ul>
<li>open_file_cache off</li>
</ul>
<p>open_flie_cache max=N [inactive=time]</p>
<p>nginx可以缓存以下三种信息</p>
<pre><code>    1. 文件的描述符、文件大小和最近一次的修改时间;
    2. 打开的目录结构;
    3. 没有找到的或者没有权限访问的文件的相关信息
</code></pre><p>max=N:可缓存的缓存项上限;达到上限后会使用LRU算法实现缓存管理;</p>
<p>inative=time:缓存项的非活动时长，在此处指定的时长内未被命中的或命中的次数少于open_file_cache_min_user指令所指定的次数的缓存项即为非活动项;</p>
<ul>
<li>open_file_cache_valid time</li>
</ul>
<p>​    缓存项有效性的检查频率;默认为60s</p>
<ul>
<li>open_file_cache_min_uses number</li>
</ul>
<p>​    在open_file_cache指令的inactive参数指定的时长内，至少应该被命中多少此方可被归类为活动项;</p>
<ul>
<li>open_file_cache_errors on | off</li>
</ul>
<p>​    是否缓存查找时发生错误的文件一类的信息</p>
<blockquote>
<p><strong>ngx_http_access_module</strong></p>
<p>​    实现基于ip的访问控制</p>
</blockquote>
<ul>
<li><p>allow address |CIDR |unix: | all;</p>
</li>
<li><p>deny address |CIDR |unix: | all;</p>
</li>
</ul>
<p>http,server,location,limit_except</p>
<blockquote>
<p><strong>ngx_http_auth_basic_module模块</strong></p>
</blockquote>
<p>​    实现基于用户的访问控制，使用basic机制进行用户认证</p>
<ul>
<li><p>auth_basic string | off</p>
</li>
<li><p>auth_basic_user_file file;</p>
</li>
</ul>
<pre><code class="shell">location / {
    auth_basic           &quot;closed site&quot;;
    auth_basic_user_file conf/htpasswd;
}
</code></pre>
<blockquote>
<p><strong>ngx_http_stub_status_module</strong></p>
</blockquote>
<p>​    用于输出nginx的基本状态信息</p>
<blockquote>
<p>Active  connections:活动状态的连接数</p>
<p>accepts:已经接受的客户端请求的总数</p>
<p>handled:已经处理完成的客户端请求的总数</p>
<p>requests:客户端发来的总的请求数</p>
<p>Reading:处于读取客户端请求报文首部的连接数</p>
<p>Writing:处于向客户端发送响应报文的连接数</p>
<p>waiting:处于等待客户端发出请求的空闲连接数</p>
</blockquote>
<ul>
<li>stub_status</li>
</ul>
<p>配置示例</p>
<pre><code>location    /basic_status {
      stub_status;
}
</code></pre><blockquote>
<p><strong>ngx_http_log_module</strong></p>
</blockquote>
<ul>
<li>log_format name string …;</li>
</ul>
<p>string可以使用nginx核心模块及其它模块内嵌的变量</p>
<ul>
<li>acccess_log path [format]   [buffer=size]  [gzip=level]  [flush=time]  [if=condition]</li>
</ul>
<p>access_log off;</p>
<p>访问日志路径，格式及相关的缓冲的配置</p>
<p>​    buffer=size</p>
<p>​    flush=time</p>
<ul>
<li>open_log_file_cache max=N [inative=time]  [min_uses=N]  [valid=time]</li>
</ul>
<p>open_log_file_cache off;</p>
<p>​    缓存日志文件相关的元数据信息;</p>
<p>​    max:缓存最大文件描述符数量</p>
<p>​    min_uses:在inactive指定的时长内访问大于等于此值方可被当作活动项</p>
<p>​    inactive:非活动时长</p>
<p>​    valid:验证缓存中各缓存项是否为活动项的时间间隔</p>
<blockquote>
<p><strong>ngx_http_gzip_module</strong></p>
</blockquote>
<ul>
<li><p>gzip on | off</p>
</li>
<li><p>gzip_comp_level level</p>
</li>
</ul>
<p>​    Sets a gzip compression level of a response. Acceptable values are in the range from 1 to 9.</p>
<ul>
<li>gzip_disable regex …;</li>
</ul>
<p>​    Disables gzipping of responses for requests with “User-Agent” header fields matching any of the specified regular expressions.</p>
<ul>
<li>gzip_min_length length</li>
</ul>
<p>​    启用压缩功能的响应报文大小阀值</p>
<ul>
<li>gzip_buffers number size</li>
</ul>
<p>​    支持实现压缩功能时为其配置的缓冲区数量及每个缓存区的大小</p>
<ul>
<li>gzip_proxued off | expired | no-chche | no-store | private | no_last_modified | no_etag | auth | any  …</li>
</ul>
<p>​    nginx作为代理服务器收到从被代理服务器发送的响应报文后，在何种条件下启用压缩功能的;</p>
<p>​    off：不启用</p>
<p>​    no-cache,no-store,private:表示从被代理服务器收到响应报文首部的cache-control的值为此三者中的任何一个，则启用</p>
<ul>
<li>gzip_types mine-type ..;</li>
</ul>
<p>​    压缩过滤器，仅对此处设定的MIME类型的内容启用压缩功能;</p>
<p>示例:</p>
<pre><code>gzip on;
gzip_comp_level 6;
gzip_min_length 64;
gzip_proxied any;
gzip_types text/xml text/css application/javasript;
</code></pre><blockquote>
<p><strong>nginx_http_ssl_module</strong></p>
</blockquote>
<ul>
<li><p>ssl on | off</p>
</li>
<li><p>ssl_certificate file</p>
</li>
</ul>
<p>​    当前虚拟主机使用PEM格式的证书文件</p>
<ul>
<li>ssl_certificate_key file</li>
</ul>
<p>​    当前虚拟主机与其证书匹配的私钥文件</p>
<ul>
<li>ssl_protocols [SSLV2]  [SSLV3]  [TLSV1.1]  [TLSV1]  [TLSV1.2]</li>
</ul>
<p>​    支持ssl协议版本，默认为后3个</p>
<ul>
<li>ssl_session_cache off | none | [builtin[:size]]  [shared:name:size]</li>
</ul>
<p>​    builtin[:size]：使用Openssl内建的缓存，此缓存为每个worker进程私有</p>
<p>​    [shared:name:size]：在各worker之间使用一个共享的缓存</p>
<ul>
<li>ssl_session_timeout time</li>
</ul>
<p>​    客户端一侧的连接可以复用ssl session cache中缓存的ssl参数有效时长</p>
<p>示例:</p>
<pre><code>server {
      listen 443 ssl;
      server_name www.domain.com;
      root /vhosts/ssl/htdocs;
      ssl on;
      ssl_certificate /etc/nginx/ssl/nginx.crt;
      ssl_certificate_key /etc/nginx/ssl/nginx.key;
      ssl_session_cache shared:sslcache:20m;
}
</code></pre><blockquote>
<p><strong>nginx_http_rewrite_module</strong></p>
</blockquote>
<p>​    将用户请求的URI基于regex所描述的模式进行检查，而后完成替换;</p>
<ul>
<li>rewirte regex replacement [flag]</li>
</ul>
<p>​    将用户请求的URI基于regex所描述的模式进行检查，匹配到时将其替换为relacement指定的新的URI</p>
<p>​    <strong>注意:</strong>如果在同一配置块中存在多个rewrite规则，那么会自上而下逐个检查;被某条件规则替换完成后，会重新一轮的替换检查，因此，隐含有循环机制;[flag]所表示的标志位用于控制此循环机制;</p>
<p>​    如果relacement是以<a href="http://或https://开头，则替换结果会直接以重向返回客户端" target="_blank" rel="noopener">http://或https://开头，则替换结果会直接以重向返回客户端</a></p>
<p>​        301:永久重定向</p>
<p>​    [flag]:</p>
<p>​        last:重写完成后停止对当前location中后续的其他重写操作，而后对新的URI启动新一轮重写检查;提前重启新一轮循环;</p>
<p>​        break:重写完成后停止对当前URI在当前location中后续的其他重写操作，而后直接跳转至重写规则配置块之后的其他配置;结束循环;</p>
<p>​        redirect:重写完成后以临时重定向方式直接返回重写后生成的新URI给客户端，有客户端重新发起请求;不能以<a href="http://或https://开头" target="_blank" rel="noopener">http://或https://开头</a></p>
<p>​        permanent:重写完成后以永久重定向方式直接返回重写后生成的新URI给客户端，由客户端重新发起请求</p>
<ul>
<li>return</li>
</ul>
<p>​    return code [text];</p>
<p>​    return code URL;</p>
<p>​    return URL;</p>
<ul>
<li><p>rewrite_log on | off;</p>
</li>
<li><p>if (condition)  {…}</p>
</li>
</ul>
<p>​    引用一个新的配置上下文，条件满足时，执行配置块中的配置指令;server,location;</p>
<p>​    condition:</p>
<p>​        比较操作符:</p>
<p>​            ==</p>
<p>​            !=</p>
<p>​            ~:模式匹配，区分字符大小写;</p>
<p>​            ~*:模式匹配，不区分字符大小写</p>
<p>​            !~:模式不匹配，区分字符大小写</p>
<p>​            !~*:模式匹配，不区分字符大小写</p>
<p>​        文件及目录存在性判断:</p>
<p>​            -e,! -e</p>
<p>​            -f,! -f</p>
<p>​            -d,! -d</p>
<p>​            -x,! -x</p>
<ul>
<li>set $varible value</li>
</ul>
<p>​    用户自定义变量</p>
<blockquote>
<p><strong>ngx_http_proxy_module</strong></p>
</blockquote>
<ul>
<li>proxy_pass URL</li>
</ul>
<p>Context: location,if in location,limit_except</p>
<p><strong>注意:</strong>proxy_pass后面的路径不带uri时，其会将Location的uri传递给后端主机</p>
<pre><code>server {
      server_name HOSTNAME;
      location /uri/ {
          proxy_pass http:host[:port];
      }
}
http://HOSTNAME/uri/ --&gt; http://host/new_uri/
</code></pre><p>如果Location定义其uri时使用了正则表达式的模式，则proxy_pass之后必须不拿使用uri;用户请求传递时传递的uri将直接附加到服务的之后;</p>
<pre><code>server {
      server_name xxxxxxx;
      location ~* /uri/ {
          proxy_pass http:host;
      }
}
http://HOSTNAME/uri/ --&gt; http://host/uri/；
</code></pre><ul>
<li>proxy_set_header field value;</li>
</ul>
<p>​    设定发往后端主机的请求报文的请求首部的值;Context: http,server,location</p>
<p>​    proxy_set_header X-Real-IP $remote_addr;</p>
<p>​    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</p>
<ul>
<li>proxy_cache_path</li>
</ul>
<p>​    定义可用于proxy功能的缓存;Context: http</p>
<p>​    proxy_cache_path path [levels=levels][use_temp_path=on|off] keys_zone=name:size [inactive=time][max_size=size][manager_files=number][manager_sleep=time][manager_threshold=time][loader_files=number][loader_sleep=time][loader_threshold=time][purger=on|off][purger_files=number][purger_sleep=time][purger_threshold=time];</p>
<ul>
<li>proxy_cache zone | off</li>
</ul>
<p>​    指明要调用的缓存，或关闭缓存的机制;Context: http,server,location</p>
<ul>
<li>proxy_cache_key string;</li>
</ul>
<p>​    缓存中用于”键”的内容    </p>
<p>​    默认值: proxy_cache_Key $scheme\$proxy_host\$request_uri</p>
<ul>
<li>proxy_cache_valid [code …]  time</li>
</ul>
<p>​    定义对特定响应码的响应内容的缓存时长</p>
<p>​    定义在http{…}中;</p>
<p>​    proxy_cache_path /var/chche/nginx/proxy_cache levels=1:1:1  keys_zone=pxycache:20m max_size=1g</p>
<p>​    定义在需要调用缓存功能的配置段，例如server {…};</p>
<p>​    proxy_cache pxychche;</p>
<p>​    proxy_cache_key $request_uri;</p>
<p>​    proxy_cache_valid 200 302 301 1h;    </p>
<p>​    proxy_cache_valid any 1m;</p>
<ul>
<li>proxy_cache_use_stale </li>
</ul>
<p>​    proxy_cache_use_stale error | timeout | invalid_header | updating | http_500 | http_502 | http_503 | http_504 |http_403 | http_404 | off …;</p>
<p>确定在与代理服务器的通信过程中发生错误时，哪种情况下可能会使用过时缓存的响应</p>
<ul>
<li><p>proxy_cache_methods GET| HEAD | POST …</p>
</li>
<li><p>proxy_hide_header field;</p>
</li>
<li><p>proxy_connect_timeout time</p>
</li>
</ul>
<p>​    默认为60s;</p>
<blockquote>
<p><strong>ngx_http_headers_module</strong></p>
</blockquote>
<p>​    向由代理服务器响应给客户端的响应报文添加自定义首部，或修改指定首部的值</p>
<ul>
<li>addr_header name value [always]</li>
</ul>
<p>​    添加自定义首部</p>
<p>​    addr_header X-Via  $server_addr;</p>
<p>​    add_header  X-Accel $server_name;</p>
<ul>
<li>expires [modified]  time</li>
</ul>
<p>​    exprires epoch | max | off;</p>
<p>​    用于定义Expire或Cache-Control首部的值;</p>
<blockquote>
<p><strong>nginx_http_fastcgi_module</strong></p>
</blockquote>
<ul>
<li><p>fastcgi_pass address</p>
</li>
<li><p>fastcgi_index name</p>
</li>
<li><p>fastcgi_param parameter value [if_not_empty]</p>
</li>
</ul>
<p>​    设置一个参数传递给FastCGI服务器。值可以包含文本、变量和它们的组合。</p>
<p>示例:</p>
<pre><code>location ~* \.php$ {
      root /data/www;
      fastcgi_pass 127.0.0.1:9000;
      fastcgi_index index.php;
      include fastcgi_params;
}
</code></pre><blockquote>
<p>通过/pm_status和/ping来获取fpm server状态信息</p>
</blockquote>
<pre><code>location ~* ^(pm_status|ping)$ {
  include    fastcgi_parms;
  fastcgi_pass 127.0.0.1:9000;
  fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
}
需要提前开启php-fpm.conf的pm_status和ping功能
</code></pre><ul>
<li>fastcgi_cache_path path [levels=levels]  [use_temp_path=on|off]  keys_zone=name:size  [inactive=time]  [max_size=size]  [manager_files=number]  [manager_sleep=time]  [manager_threshold=time]  [loader_files=number]  [loader_sleep=time]  [loader_threshold=time]  [purger_files=number]  [purger_sleep=time]  [purger_threshold=time]</li>
</ul>
<p>​    定义fastcgi的缓存;缓存位置为磁盘上的文件系统，由path所指定路径来定义;    </p>
<p>​        levels=lebels: 缓存目录的层级数量，以及每一级的目录数量;levels=ONE;TWO;THREE</p>
<p>​            leves=2:1:1</p>
<p>​        keys_zone=name:size</p>
<p>​            k/v映射的内存空间的名称及大小</p>
<p>​        inactive=time</p>
<p>​            非活动时长</p>
<p>​        max_size=size</p>
<p>​            磁盘上用于缓存数据的缓存空间上限</p>
<ul>
<li>fascgi_cache zone | off;</li>
</ul>
<p>​    调用指定的缓存空间来缓存数据;http,server,location</p>
<ul>
<li>fastcgi_cache_key string;</li>
</ul>
<p>​    定义用作缓存项的key的字符串;</p>
<ul>
<li>fastcgi_chche_methods GET| HEAD| POST..;</li>
</ul>
<p>​    为那些请求方法使用缓存</p>
<ul>
<li>fastcgi_cache_min_user number;</li>
</ul>
<p>​    缓存空间中的缓存项在inactive定义的非活动时间内至少要被访问到此处所指定的次数方可被认作活动项</p>
<ul>
<li>fastcgi_cache_valid [code..] time</li>
</ul>
<p>​    不同的响应码各自缓存时长</p>
<p>示例</p>
<pre><code>http {
  ...
  fastcgi_cache_path /var/cache/nginx/fastcgi_cache levels=2:1:1 keys_zone=fcgi:20m inactive=120s;
  ...
  server {
    ...
    location ~* \.php$ {
          ...
          fastcgi_cache fcgi;
          fastcgi_cache_key $request_uri;
          fastcgi_cache_valid 200 302 10m;
          fastcgi_cache_valid 301 1h;
          fastcgi_cache_valid any 1m;
    }
  }
}
</code></pre><ul>
<li>fastcgi_keep_conn on | off;</li>
</ul>
<blockquote>
<p>默认情况下，一个 FastCGI 服务器将关闭连接右后发送响应。<em>*然而，当此指令设置的值时，nginx 将指示 FastCGI 服务器将使连接保持打开。</em></p>
</blockquote>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shensir.info/2017/05/14/Nginx配置及优化/" data-id="cjb07228u0009gezuobsiytcy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/">web</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nfs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/13/nfs/" class="article-date">
  <time datetime="2017-05-13T07:42:51.000Z" itemprop="datePublished">2017-05-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/13/nfs/">nfs</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="nfs实践作业"><a href="#nfs实践作业" class="headerlink" title="nfs实践作业"></a>nfs实践作业</h2><blockquote>
<p>(1) nfs server导出/data/application/web，在目录中提供wordpress;</p>
<p>(2) nfs client挂载nfs server导出的文件系统至/var/www/html；</p>
<p>(3) 客户端（lamp）部署wordpress，并让其正常访问；要确保能正常发文章，上传图片；</p>
<p>(4) 客户端2(lamp)，挂载nfs server导出的文件系统至/var/www/html；验正其wordpress是否可被访问； 要确保能正常发文章，上传图片；</p>
</blockquote>
<h3 id="nfs-server端"><a href="#nfs-server端" class="headerlink" title="nfs server端"></a>nfs server端</h3><ul>
<li><p>安装配置nfs</p>
<pre><code>yum install nfs-utiles -y
vim /etc/exports
/data/application/web/  172.18.0.0/16(rw,async)
chmod -R 777 //data/application/web/wordpress
</code></pre></li>
<li><p>client1</p>
<pre><code>yum install httpd mairadb-server php-fpm php php-mysql
mysql
create database wp;
grant all privileges on *.* to wp@&#39;%&#39; identified by &#39;123&#39;;
flush privileges;
quit;
mount -t nfs nfs server ip:/data/application/web /var/www/html/
</code></pre></li>
<li><p>client2</p>
<pre><code>yum install httpd mairadb-server php-fpm php php-mysql
mount -t nfs nfs server ip:/data/application/web /var/www/html/
</code></pre><p>​</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shensir.info/2017/05/13/nfs/" data-id="cjb07229j001pgezulp2q3p00" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nfs/">nfs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/文件共享/">文件共享</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-lvs-nat-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/13/lvs-nat-1/" class="article-date">
  <time datetime="2017-05-13T07:37:08.000Z" itemprop="datePublished">2017-05-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/13/lvs-nat-1/">keepalived实现lvs-nat</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="keepalived实现lvs-nat"><a href="#keepalived实现lvs-nat" class="headerlink" title="keepalived实现lvs-nat"></a>keepalived实现lvs-nat</h3><p><strong>实验拓扑</strong></p>
<p><img src="http://omsab2via.bkt.clouddn.com/lvs-nat.png" alt="lvs-nat"></p>
<p><strong>配置</strong></p>
<ul>
<li><h5 id="配置前提"><a href="#配置前提" class="headerlink" title="配置前提"></a>配置前提</h5><ul>
<li>各节点时间必须同步(ntp,chrony)</li>
<li>iptables、selinux</li>
<li>各节点之间可通过主机名实现互相通信(对ka并非必须)，一般用hosts</li>
<li>各节点之间的root用户可以基于密匙认证完成互相通信；(非必须)</li>
</ul>
</li>
</ul>
<ul>
<li><pre><code>iptables -F
setenforce 0
yum install httpd php -y
echo 119 &gt; /var/www/html/1.html
120
echo 120 &gt; /var/www/html/1.html
</code></pre></li>
<li><p>Director 1</p>
<pre><code>iptables -F
setenforce 0
echo 1 &gt; /proc/sys/net/ipv4/ip_forward
yum -y install keepalived
#配置文件
! Configuration File for keepalived
global_defs {
   notification_email {
     sysadmin@firewall.loc
   }
   notification_email_from Alexandre.Cassen@firewall.loc
   smtp_server 192.168.200.1
   smtp_connect_timeout 30
   router_id dr1
   vrrp_mcast_group4 224.0.0.50  广播地址
}
vrrp_instance mvr {
    state MASTER #指定Keepalived的角色，MASTER为主服务器，BACKUP为备用服务器
    interface ens33
    virtual_router_id 50  #虚拟路由标识(1-255)，在一个VRRP实例中主备服务器ID必须一样
    priority 100  #优先级
    advert_int 1  #设置主备之间同步检查时间间隔，单位秒
    authentication { #认证，以一个VRRP实例中主备服务器pass必须一致
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        172.18.50.100/16 dev ens33
    }
}
vrrp_instance mvr1  {
    state MASTER
    interface ens38
    virtual_router_id 51
    priority 100
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1a111
    }
    virtual_ipaddress {
        192.168.50.100/24 dev ens38
    }
}
virtual_server 172.18.50.100 80 { #设置虚拟服务器
    delay_loop 6     #服务轮询的时间间隔
    lb_algo rr          # rr|wrr|lc|wlc|lblc|sh|dh：定义调度方法
    lb_kind NAT         # NAT|DR|TUN：集群的类型
    nat_mask 255.255.0.0
    persistence_timeout 0 #持久时间时长 单位为s
    protocol TCP

    real_server 192.168.50.119 80 {
        weight 1
        HTTP_GET {   #设置检测方式
            url {
              path /1.html
              status_code 200 #设定返回状态码为200表示Realserver存活
            } 
            connect_timeout 3 #设置响应超时时间
            nb_get_retry 3      #设置超时重试次数
            delay_before_retry 3     #设置超时重试间隔
        }   
}
    real_server 192.168.50.120 80 {
        weight 1
        HTTP_GET {
            url {
              path /1.html
              status_code 200
            } 
            connect_timeout 3
            nb_get_retry 3
            delay_before_retry 3
}
}
}
</code></pre></li>
<li><p>Director 2</p>
<pre><code>! Configuration File for keepalived
global_defs {
   notification_email {
     sysadmin@firewall.loc
   }
   notification_email_from Alexandre.Cassen@firewall.loc
   smtp_server 192.168.200.1
   smtp_connect_timeout 30
   router_id dr2
   vrrp_mcast_group4 224.0.0.50
}
vrrp_instance mvr {
    state BACKUP
    interface ens33
    virtual_router_id 50
    priority 98
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        172.18.50.100/16 dev ens33
    }
    notify_master &quot;/root/keepalived.sh master&quot;
    notify_backup &quot;/root/keepalived.sh backup&quot;
    notify_fault &quot;/root/keepalived.sh fault&quot;
}
vrrp_instance mvr1 {
    state BACKUP
    interface ens38
    virtual_router_id 51
    priority 98
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1a111
    }
    virtual_ipaddress {
        192.168.50.100/24 dev ens38
    }
    notify_master &quot;/root/keepalived.sh master&quot;
        notify_backup &quot;/root/keepalived.sh backup&quot;
    notify_fault &quot;/root/keepalived.sh fault&quot;

}
virtual_server 172.18.50.100 80 {
    delay_loop 6
    lb_algo rr
    lb_kind NAT
    nat_mask 255.255.0.0
    persistence_timeout 0
    protocol TCP

    real_server 192.168.50.119 80 {
        weight 1
        HTTP_GET {
            url {
              path /1.html
              status_code 200
            } 
            connect_timeout 3
            nb_get_retry 3
            delay_before_retry 3
        }
}
    real_server 192.168.50.120 80 {
        weight 1
        HTTP_GET {
            url {
              path /1.html
              status_code 200
            } 
            connect_timeout 3
            nb_get_retry 3
            delay_before_retry 3
        }
}
}
</code></pre><p>​</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shensir.info/2017/05/13/lvs-nat-1/" data-id="cjb07229h001jgezu5743zto3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/keepalived/">keepalived</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lvs/">lvs</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iptables" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/02/iptables/" class="article-date">
  <time datetime="2017-05-02T03:15:58.000Z" itemprop="datePublished">2017-05-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/02/iptables/">iptables/netfilter入门到进阶</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Iptables-配置"><a href="#Iptables-配置" class="headerlink" title="Iptables  配置"></a>Iptables  配置</h3><blockquote>
<p>iptables,一个运行在用户空间的应用软件，通过控制Linux内核netfilter模块，来管理网络数据包的流动与转送。</p>
</blockquote>
<p><strong>Table</strong></p>
<ul>
<li><p>filter</p>
<blockquote>
<p>主要用于过滤数据包，该表根据系统管理员预定义的一组规则过滤符合条件的数据包。对于防火墙而言，注意利用在filter表中指定的规则来实现对数据包的过滤。Filter表是默认的表，包含了INPUT链，FORWARD链，OUTPUT链，在filter表中只能允许数据包进行接受，丢弃的操作，而无法对数据包进行更改。</p>
</blockquote>
</li>
<li><p>nat</p>
<blockquote>
<p>主要用于网络地址转换，该表可以实现一对一，一堆多，多对多等NAT工作，iptables就是使用该表实现共享上网的，NAT表包含了PREROUTING，INPUT，OUPUT，POSTROUTING链</p>
</blockquote>
</li>
<li><p>mangle</p>
<blockquote>
<p>主要用于对指定的数据包进行更改，在内核版本2.4.18后包含的链为:INPUT链，RORWARD链，OUTPUT链，POSTROUTING链，PREROUTING链</p>
</blockquote>
</li>
<li><p>raw</p>
<blockquote>
<p>只使用在PREROUTING链和OUTPUT链上，因为优先级最高，从而对收到的数据包在连接跟踪前进行处理。一旦用户使用了RAW表，RAW表处理完后，将跳过NAT表和ip_conntrack处理，即不再做地址转换和数据包的链接跟踪处理了。</p>
</blockquote>
</li>
<li><p>Table之间的优先级顺序</p>
<p>Raw—-&gt;Mangle—-&gt;Nat—-&gt;Filter</p>
<p>​</p>
</li>
</ul>
<p><strong>Chain</strong></p>
<ul>
<li>PREROUTING</li>
<li>INPUT</li>
<li>FORWARD</li>
<li>OUTPUT</li>
<li>POSTROUTING</li>
</ul>
<p><strong>Iptables 命令格式</strong></p>
<blockquote>
<p>iptables [-t table] COMMAND [chain] [PARAMETERS] [-m matchname [per-match-options]  [-j targetname [per-target-options]]</p>
</blockquote>
<ul>
<li><p>COMMAND</p>
<ul>
<li>链管理<ul>
<li>-P    定义默认策略<ul>
<li>-X  删除自定义链</li>
<li>-N新建自定义链</li>
<li>-E修改chain名</li>
<li>-F删除表中所有规则</li>
<li>-Z将表中数据包计数器和流量计数器归零</li>
</ul>
</li>
</ul>
</li>
<li>规则管理<ul>
<li>-A    追加<ul>
<li>-I插入</li>
<li>-R替换</li>
<li>-D删除</li>
</ul>
</li>
</ul>
</li>
<li>查看<ul>
<li>-L    查看<ul>
<li>-n数字输出。IP地址和端口号将打印在数字格式。</li>
<li>-v详细</li>
<li>-x展开数字显示数据包和字节计数器的确切值，而不是仅K中的舍入数</li>
<li>–line-numbers显示链行号</li>
<li>-S Print all rules in the selected chain</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>匹配条件</p>
<ul>
<li><p>基本匹配PARAMETERS</p>
<ul>
<li>-s    source<ul>
<li>-ddestination</li>
<li>-pprotocol</li>
<li>-i流入接口</li>
<li>-o流出接口</li>
<li>-m模块</li>
</ul>
</li>
</ul>
</li>
<li><p>扩展匹配条件</p>
<ul>
<li><p>隐式扩展:在使用-p选项指明了特定的协议时，无需再同时使用-m选项指明扩展模块的扩展机制;</p>
<p>-p tcp：可直接使用tcp扩展模块的专用选项</p>
<p>​    [!] –source-port,–sport prot[:port] 匹配报文源端口;可以给出多个端口，但只能是连续的端口范围;</p>
<p>​    [!] –destination -port,–dport port[:port] 匹配报文目标端口;可以给出多个端口，但只能是连续的端口范围;</p>
<p>​    [!] –tcp-flags mask comp 匹配报文中的tcp协议标志位; Flags are：SYN ACK FIN RST URG PSH ALL NONE;</p>
<p>​        mask：要检查的FLAGS LIST，以逗号分割;</p>
<p>​        comp：在mask给定的诸多的FLAGS中，其值为1的FLAGS列表，余下的值必须为0;</p>
<p>​            –tcp-flags SYN,ACK,FIN,RST SYN</p>
<p>​            –tcp-flags ALL ALL</p>
<p>​    [!] –syn: –tcp-flags SYN,ACK,FIN,RST SYN</p>
<p>-p udp:可直接使用udp协议扩展模块的专用选项</p>
<p>​    [!] –source-port,–sport port[:port]</p>
<p>​    [!] –destination-port,–dport port[:port]</p>
<p>[!] –icmp-type {type[/code]|typename}</p>
<p>​    0/0: reply</p>
<p>​    8/0:request</p>
</li>
<li><p>显式扩展:必须使用-m选项要调用的扩展模块机制;</p>
<p>1.multiport</p>
<p>​    以离散或连续的方式定义多端口匹配条件，最多15个;</p>
<p>​    [!] –source-ports,–sports port[,port|,port:port] 指定多个源端口</p>
<p>​    [!] –destination-ports,–dports port[,port|,port:port] 指定多个目标端口</p>
<p>2.iprange</p>
<p>​    以连续地址块的方式来指明多IP地址匹配条件</p>
<p>​    [!] –src-range from [-to]</p>
<p>​    [!] –dst-range from [-to]</p>
<p>​    例如:</p>
<p>​    # iptables -I INPUT -d 172.16.0.7 -p tcp -m multiport –dports 22,80,139,445,3306 -m iprange –src-range 172.16.0.61-172.16.0.70 -j REJECT</p>
<p>3.time</p>
<p>​    –timestart hh:mm[:ss]</p>
<p>​    –timestop hh:mm[:ss]</p>
<p>​    [!] –weekdays day[,day..]</p>
<p>​    [!] –monthdays day[,day…]</p>
<p>​    –datestart YYYY[-MM[-DD[Thh[:mm[:ss]]]]]    </p>
<p>​    –datestop YYYY[-MM[-DD[Thh[:mm[:ss]]]]]    </p>
<p>​    –kerneltz:使用内核配置的失去而非默认的UTC</p>
<p>​    例如:</p>
<p>​    iptables -A INPUT -p tcp –dport 22 -m time –timestart 13:45 –timestop 13:50 –kerneltz  -j DROP</p>
<p>4.string</p>
<p>​    –algo {bm|kmp}</p>
<p>​    [!] –string pattern</p>
<p>​    [!] –hex-string pattern</p>
<p>​    –form offset</p>
<p>​    –to offset</p>
<p>​    例如</p>
<p>​    ~]# iptables -I OUTPUT -m string –algo bm –string “gay” -j REJECT    </p>
<p>5.connlimit</p>
<p>​    Allows  you  to  restrict  the  number  of parallel connections to a server per client IP address (or client address block).</p>
<p>​    –connlimit-upto n</p>
<p>​    –connlimit-above n</p>
<p>​    eg:</p>
<p>​    iptables -I INPUT -d  172.18.0.7     -p tcp –syn –dport 22 -m connlimit –connlimit-adove 2 -j REJECT</p>
<p>6.limit</p>
<p>​    –limit rete [/second/minute/hour/day]</p>
<p>​    –limit burst number</p>
<p>7.state</p>
<p>​    [!] –state state</p>
<p>​    INVALID,ESTABLISHED,NEW,RELATED or UNTRACKED</p>
<p>​    INVALID:无法识别的连接;</p>
<p>​    RELATED:相关联的连接，当前请求是一个新的请求，但附属与某个已存在的连接;</p>
<p>​    UNTRACKED:未追踪的连接;</p>
<p>​    </p>
<p>​    state扩展:</p>
<p>​        内核模块装载:</p>
<p>​            nf_conntrack</p>
<p>​            nf_conntrack_ipv4</p>
<p>​        手动装载</p>
<p>​            nf_conntrack_ftp</p>
<p>​    追踪到的连接</p>
<p>​        /proc/net/nf_conntrack</p>
<p>​    调整可记录的连接数量最大值</p>
<p>​        /proc/sys/net/nf_conntrack_max</p>
<p>​    超时时长</p>
<p>​        /proc/sys/net/netfilter/*timeout*    </p>
<p>​        </p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Targetname</p>
<ul>
<li><p>ACCEPT</p>
</li>
<li><p>DROP</p>
</li>
<li><p>REJECT</p>
<p>–reject-with type </p>
<p>​    icmp-net-unreachable</p>
<p>​    icmp-host-unreachable</p>
<p>​    icmp-port-unreachable</p>
<p>​    icmp-proto-unreach‐ able</p>
<p>​    icmp-net-prohibited</p>
<p>​    icmp-host-prohibited</p>
<p>​    icmp-admin-prohibited (*)</p>
<p>​    icmp-port-unreachable is the default</p>
</li>
<li><p>RETURN</p>
</li>
</ul>
</li>
</ul>
<p><strong>Nat</strong></p>
<ul>
<li><p>SNAT</p>
<blockquote>
<p>This  target  is only valid in the nat table, in the POSTROUTING and INPUT chains, and user-defined chains which are only called from those chains.</p>
<p>–to-source [ipaddr[-ipaddr]]</p>
</blockquote>
</li>
<li><p>DNAT</p>
<blockquote>
<p>This target is only valid in the nat table, in the PREROUTING and OUTPUT chains, and user-defined chains  which  are only  called from those chains.</p>
<p>–to-destination [ipaddr[-ipaddr]] [:port[:port]]</p>
</blockquote>
</li>
<li><p>MASQUERADE</p>
<blockquote>
<p>This target is only valid in the nat table, in the POSTROUTING chain.  It  should  only  be  used  with  dynamically assigned  IP (dialup) connections: if you have a static IP address, you should use the SNAT target.</p>
</blockquote>
</li>
<li><p>REDIRECT</p>
<blockquote>
<p>–to-ports port [-port]</p>
</blockquote>
</li>
<li><p>添加规则</p>
<blockquote>
<p>iptables -t nat -A PREROUTING -i eth0 -s 10.0.0.0/8 -j DROP</p>
<p> iptables -t nat -A PREROUTING -i eth0 -s 172.16.0.0/12 -j DROP</p>
<p>iptables -t nat -A PREROUTING -i eth0 -s 192.168.0.0/16 -j DROP</p>
<p>防止外网用户用内网ip欺骗</p>
</blockquote>
</li>
<li><p>删除规则</p>
<blockquote>
<p>iptables -F -t nat</p>
<p>iptables -X -t nat</p>
<p>iptables -Z -t nat</p>
</blockquote>
</li>
<li><p>eg</p>
<pre><code>   # IMPORTANT: Activate IP-forwarding in the kernel!
   # Disabled by default!
   #
   $&gt; echo &quot;1&quot; &gt; /proc/sys/net/ipv4/ip_forward   
   # Load various modules. Usually they are already loaded 
   # (especially for newer kernels), in that case 
   # the following commands are not needed.
   #
   # Load iptables module:
   $&gt; modprobe ip_tables
   #
   # activate connection tracking
   # (connection&#39;s status are taken into account)
   $&gt; modprobe ip_conntrack
   #
   # Special features for IRC:
   $&gt; modprobe ip_conntrack_irc
   #
   # Special features for FTP:
   $&gt; modprobe ip_conntrack_ftp
   $&gt; iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE
</code></pre></li>
</ul>
<p><strong>常用配置</strong></p>
<blockquote>
<p>DROP非法连接</p>
<p>iptables -A INPUT -m state –state INVALID -j DROP</p>
<p>iptables -A OUTPUT -m state –state INVALID -j DROP</p>
<p>iptables -A FORWARD -m state –state INVALID -j DROP</p>
<p>允许已经建立和相关的连接</p>
<p>iptables -A INOUT -m state –state ESTABLISHED,RELATED -j ACCEPT</p>
<p>iptables -A OUTPUT -m state –state  ESTABLISHED,RELATED -j ACCEPT</p>
<p>放行smb服务</p>
<p>iptables -I INPUT 2 -d 172.18.50.72 -p tcp -m multiport –dports 139,445 -m state –state NEW -j ACCEPT</p>
<p>放行vsftpd</p>
<p>iptables -I INPUT 2 -d 172.18.50.72 -m state –state ESTABLISHED,RELATED -j ACCEPT</p>
<p>需要装载ftp模块</p>
<p>modprobe nf_conntrack_ftp</p>
</blockquote>
<p><strong>保存和载入规则</strong></p>
<ul>
<li><p>保存</p>
<blockquote>
<p>iptables-save &gt; /path/filename</p>
</blockquote>
</li>
<li><p>重载</p>
<blockquote>
<p>iptables-restore &lt; /path/filename</p>
</blockquote>
</li>
<li><p>centos 6</p>
<ul>
<li><p>保存规则</p>
<blockquote>
<p>service iptavles save</p>
<p>保存规则与/etc/sysconfig/iptables文件，覆盖保存</p>
</blockquote>
</li>
<li><p>重载规则</p>
<blockquote>
<p>service iptables restart</p>
<p>默认重载/etc/sysconfig/iptables文件中的规则</p>
</blockquote>
</li>
<li><p>配置文件</p>
<blockquote>
<p>/etc/sysconfig/iptables-config</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p><strong>规则优化</strong></p>
<blockquote>
<p>使用自定义链管理特定的相关规则，模块化管理规则</p>
</blockquote>
<ul>
<li>优先放行双向状态为ESTABLISHED的报文</li>
<li>服务与不同类别的功能的规则，匹配到报文可能性更大的放前面</li>
<li>服务与同一类别的功能的规则，匹配条件较为严格的放在前面</li>
<li>设置默认策略:白名单机制<ul>
<li>iptables -P</li>
<li>建议在规则的最后定义规则作为默认策略</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shensir.info/2017/05/02/iptables/" data-id="cjb07229d0019gezup3qk1bwt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Iptables/">Iptables</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-http-modules" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/29/http-modules/" class="article-date">
  <time datetime="2017-04-29T01:24:28.000Z" itemprop="datePublished">2017-04-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/29/http-modules/">Http Configure the source tree</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Httpd-Configure-the-source-tree"><a href="#Httpd-Configure-the-source-tree" class="headerlink" title="Httpd   Configure the source tree"></a>Httpd   Configure the source tree</h3><blockquote>
<p>configure脚本配置Apache的源码树并且将其安装到指定的平台上。</p>
</blockquote>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a><strong>语法</strong></h4><blockquote>
<p>./configure [OPTION]… [VAR=VALUE]…</p>
</blockquote>
<h4 id="选项"><a href="#选项" class="headerlink" title="选项"></a><strong>选项</strong></h4><ul>
<li><p>配置选项</p>
<blockquote>
<p>下列选项会影响configure脚本自身的行为。方括号”[]”内是默认值。</p>
</blockquote>
<pre><code class="shell">-C
--config-cache  
    等价于 --cache-file=config.cache
--cache-file=FILE
    在FILE文件中缓存测试结果(默认禁用)。
-q
--quiet
    不显示脚本工作期间输出的&quot;checking ...&quot;消息
--srcdir=DIR
    指定源代码所在目录DIR
</code></pre>
</li>
<li><p>安装目录</p>
<blockquote>
<p>这些选项控制着安装目录的结构。安装目录的结构取决于所选择的布局。</p>
</blockquote>
<pre><code class="shell">--prefix=PREFIX
    体系无关文件的顶级安装目录PREFIX,也就是Apache的安装目录。默认安装目录[/usr/local/apache2]
--exec-prefix=EPREFIX
    体系相关文件的顶级安装目录PEPREFIX,把体系相关文件安装到不同的位置可以方便的在不同主机之间共享体系相关的文件。默认情况下,make install将会把所有文件分别安装到/usr/local/apache2/bin,/usr/local/apache2/lib目录下。可以用--prefix指定一个不同与/usr/local/apache2的安装前缀,比如:--prefix=$HOME
</code></pre>
<blockquote>
<p>定义一个目录布局</p>
</blockquote>
<pre><code class="shel">--enable-layout=LAYOUT
    使用名为LAYOUT的布局配置所有源代码和编译脚本。这样就允许你在安装apache时分别指定不同文件的安装位置。config.lauout文件中包含了默认布局的示例，如下:
</code></pre>
<pre><code class="shell">[root@72 httpd-2.4.25]# cat config.layout 
##
##  config.layout -- Pre-defined Installation Path Layouts
##
##  Hints:
##  - layouts can be loaded with configure&#39;s --enable-layout=ID option
##  - when no --enable-layout option is given, the default layout is `Apache&#39;
##  - a trailing plus character (`+&#39;) on paths is replaced with a 
##    `/&lt;target&gt;&#39; suffix where &lt;target&gt; is currently hardcoded to &#39;apache2&#39;.
##    (This may become a configurable parameter at some point.)
##
#   Classical Apache path layout.
&lt;Layout Apache&gt;
    prefix:        /usr/local/apache2
    exec_prefix:   ${prefix}
    bindir:        ${exec_prefix}/bin
    sbindir:       ${exec_prefix}/bin
    libdir:        ${exec_prefix}/lib
    libexecdir:    ${exec_prefix}/modules
    mandir:        ${prefix}/man
    sysconfdir:    ${prefix}/conf
    datadir:       ${prefix}
    installbuilddir: ${datadir}/build
    errordir:      ${datadir}/error
    iconsdir:      ${datadir}/icons
    htdocsdir:     ${datadir}/htdocs
    manualdir:     ${datadir}/manual
    cgidir:        ${datadir}/cgi-bin
    includedir:    ${prefix}/include
    localstatedir: ${prefix}
    runtimedir:    ${localstatedir}/logs
    logfiledir:    ${localstatedir}/logs
    proxycachedir: ${localstatedir}/proxy
&lt;/Layout&gt;
#   GNU standards conforming path layout.
#   See FSF&#39;s GNU project `make-stds&#39; document for details.
&lt;Layout GNU&gt;
    prefix:        /usr/local
    exec_prefix:   ${prefix}
    bindir:        ${exec_prefix}/bin
    sbindir:       ${exec_prefix}/sbin
    libdir:        ${exec_prefix}/lib
    libexecdir:    ${exec_prefix}/libexec
    mandir:        ${prefix}/man
    sysconfdir:    ${prefix}/etc+
    datadir:       ${prefix}/share+
    installbuilddir: ${datadir}/build
    errordir:      ${datadir}/error
    iconsdir:      ${datadir}/icons
    htdocsdir:     ${datadir}/htdocs
    manualdir:     ${datadir}/manual
    cgidir:        ${datadir}/cgi-bin
    includedir:    ${prefix}/include+
    localstatedir: ${prefix}/var+
    runtimedir:    ${localstatedir}/run
    logfiledir:    ${localstatedir}/log
    proxycachedir: ${localstatedir}/proxy
&lt;/Layout&gt;
#   Mac OS X Server (Rhapsody)
&lt;Layout Mac OS X Server&gt;
    prefix:        /Local/Library/WebServer
    exec_prefix:   /usr
    bindir:        ${exec_prefix}/bin
    sbindir:       ${exec_prefix}/sbin
    libdir:        ${exec_prefix}/lib
    libexecdir:    /System/Library/Apache/Modules
    mandir:        ${exec_prefix}/share/man
    sysconfdir:    ${prefix}/Configuration
    datadir:       ${prefix}
    installbuilddir: /System/Library/Apache/Build
    errordir:      /System/Library/Apache/Error
    iconsdir:      /System/Library/Apache/Icons
    manualdir:     /System/Library/Apache/Manual
    htdocsdir:     ${datadir}/Documents
    cgidir:        ${datadir}/CGI-Executables
    includedir:    /System/Library/Frameworks/Apache.framework/Versions/2.0/Headers
    localstatedir: /var
    runtimedir:    ${prefix}/Logs
    logfiledir:    ${prefix}/Logs
    proxycachedir: ${prefix}/ProxyCache
&lt;/Layout&gt;
#   Darwin/Mac OS Layout
&lt;Layout Darwin&gt;
    prefix:        /usr
    exec_prefix:   ${prefix}
    bindir:        ${exec_prefix}/bin
    sbindir:       ${exec_prefix}/sbin
    libdir:        ${exec_prefix}/lib
    libexecdir:    ${exec_prefix}/libexec+
    mandir:        ${prefix}/share/man
    datadir:       /Library/WebServer
    sysconfdir:    /etc+
    installbuilddir: ${prefix}/share/httpd/build
    errordir:      ${prefix}/share/httpd/error
    iconsdir:      ${prefix}/share/httpd/icons
    htdocsdir:     ${datadir}/Documents
    manualdir:     ${datadir}/share/httpd/manual
    cgidir:        ${datadir}/CGI-Executables
    includedir:    ${prefix}/include+
    localstatedir: /var
    runtimedir:    ${localstatedir}/run
    logfiledir:    ${localstatedir}/log+
    proxycachedir: ${runtimedir}/proxy
&lt;/Layout&gt;
#   Red Hat Linux 7.x layout
&lt;Layout RedHat&gt;
    prefix:        /usr
    exec_prefix:   ${prefix}
    bindir:        ${prefix}/bin
    sbindir:       ${prefix}/sbin
    libdir:        ${prefix}/lib
    libexecdir:    ${prefix}/lib/apache
    mandir:        ${prefix}/man
    sysconfdir:    /etc/httpd/conf
    datadir:       /var/www
    installbuilddir: ${datadir}/build
    errordir:      ${datadir}/error
    iconsdir:      ${datadir}/icons
    htdocsdir:     ${datadir}/html
    manualdir:     ${datadir}/manual
    cgidir:        ${datadir}/cgi-bin
    includedir:    ${prefix}/include/apache
    localstatedir: /var
    runtimedir:    ${localstatedir}/run
    logfiledir:    ${localstatedir}/log/httpd
    proxycachedir: ${localstatedir}/cache/httpd
&lt;/Layout&gt;     
#   According to the /opt filesystem conventions
&lt;Layout opt&gt;
    prefix:        /opt/apache
    exec_prefix:   ${prefix}
    bindir:        ${exec_prefix}/bin
    sbindir:       ${exec_prefix}/sbin
    libdir:        ${exec_prefix}/lib
    libexecdir:    ${exec_prefix}/libexec
    mandir:        ${prefix}/man
    sysconfdir:    /etc${prefix}
    datadir:       ${prefix}/share
    installbuilddir: ${datadir}/build
    errordir:      ${datadir}/error
    iconsdir:      ${datadir}/icons
    htdocsdir:     ${datadir}/htdocs
    manualdir:     ${datadir}/manual
    cgidir:        ${datadir}/cgi-bin
    includedir:    ${prefix}/include
    localstatedir: /var${prefix}
    runtimedir:    ${localstatedir}/run
    logfiledir:    ${localstatedir}/logs
    proxycachedir: ${localstatedir}/proxy
&lt;/Layout&gt;
#   SuSE 6.x layout
&lt;Layout SuSE&gt;
    prefix:        /usr
    exec_prefix:   ${prefix}
    bindir:        ${prefix}/bin
    sbindir:       ${prefix}/sbin
    libdir:        ${prefix}/lib
    libexecdir:    ${prefix}/lib/apache
    mandir:        ${prefix}/share/man
    sysconfdir:    /etc/httpd
    datadir:       /usr/local/httpd
    installbuilddir: ${datadir}/build
    errordir:      ${datadir}/error
    iconsdir:      ${datadir}/icons
    htdocsdir:     ${datadir}/htdocs
    manualdir:     ${datadir}/manual
    cgidir:        ${datadir}/cgi-bin
    includedir:    ${prefix}/include/apache
    localstatedir: /var/lib/httpd
    runtimedir:    /var/run
    logfiledir:    /var/log/httpd
    proxycachedir: /var/cache/httpd
&lt;/Layout&gt;
#   BSD/OS layout
&lt;Layout BSDI&gt;
    prefix:        /var/www
    exec_prefix:   /usr/contrib
    bindir:        ${exec_prefix}/bin
    sbindir:       ${exec_prefix}/bin
    libdir:        ${exec_prefix}/lib
    libexecdir:    ${exec_prefix}/libexec/apache
    mandir:        ${exec_prefix}/man
    sysconfdir:    ${prefix}/conf
    datadir:       ${prefix}
    installbuilddir: ${datadir}/build
    errordir:      ${datadir}/error
    iconsdir:      ${datadir}/icons
    htdocsdir:     ${datadir}/htdocs
    manualdir:     ${datadir}/manual
    cgidir:        ${datadir}/cgi-bin
    includedir:    ${exec_prefix}/include/apache
    localstatedir: /var
    runtimedir:    ${localstatedir}/run
    logfiledir:    ${localstatedir}/log/httpd
    proxycachedir: ${localstatedir}/proxy
&lt;/Layout&gt;
#   Solaris 8 Layout
&lt;Layout Solaris&gt;
    prefix:        /usr/apache
    exec_prefix:   ${prefix}
    bindir:        ${exec_prefix}/bin
    sbindir:       ${exec_prefix}/bin
    libdir:        ${exec_prefix}/lib
    libexecdir:    ${exec_prefix}/libexec
    mandir:        ${exec_prefix}/man
    sysconfdir:    /etc/apache
    datadir:       /var/apache
    installbuilddir: ${datadir}/build
    errordir:      ${datadir}/error
    iconsdir:      ${datadir}/icons
    htdocsdir:     ${datadir}/htdocs
    manualdir:     ${datadir}/manual
    cgidir:        ${datadir}/cgi-bin
    includedir:    ${exec_prefix}/include
    localstatedir: ${prefix}
    runtimedir:    /var/run
    logfiledir:    ${datadir}/logs
    proxycachedir: ${datadir}/proxy
&lt;/Layout&gt;
#   OpenBSD Layout
&lt;Layout OpenBSD&gt;
    prefix:        /var/www
    exec_prefix:   /usr
    bindir:        ${exec_prefix}/bin
    sbindir:       ${exec_prefix}/sbin
    libdir:        ${exec_prefix}/lib
    libexecdir:    ${exec_prefix}/lib/apache/modules
    mandir:        ${exec_prefix}/share/man
    sysconfdir:    ${prefix}/conf
    datadir:       ${prefix}
    installbuilddir: ${prefix}/build
    errordir:      ${prefix}/error
    iconsdir:      ${prefix}/icons
    htdocsdir:     ${prefix}/htdocs
    manualdir:     ${datadir}/manual
    cgidir:        ${prefix}/cgi-bin
    includedir:    ${exec_prefix}/lib/apache/include
    localstatedir: ${prefix}
    runtimedir:    ${prefix}/logs
    logfiledir:    ${prefix}/logs
    proxycachedir: ${prefix}/proxy
&lt;/Layout&gt;
# FreeBSD Layout
&lt;Layout FreeBSD&gt;
  prefix:        /usr/local
  exec_prefix:   ${prefix}
  bindir:        ${exec_prefix}/bin
  sbindir:       ${exec_prefix}/sbin
  libdir:        ${exec_prefix}/lib
  libexecdir:    ${exec_prefix}/libexec/apache2
  mandir:        ${prefix}/man
  sysconfdir:    ${prefix}/etc/apache2
  datadir:       ${prefix}/www
  installbuilddir: ${prefix}/share/apache2/build
  errordir:      ${datadir}/error
  iconsdir:      ${datadir}/icons
  htdocsdir:     ${datadir}/data
  manualdir:     ${prefix}/share/doc/apache2
  cgidir:        ${datadir}/cgi-bin
  includedir:    ${prefix}/include/apache2
  localstatedir: /var
  runtimedir:    ${localstatedir}/run
  logfiledir:    ${localstatedir}/log
  proxycachedir: ${datadir}/proxy
&lt;/Layout&gt;
# Debian layout
&lt;Layout Debian&gt;
    prefix:        
    exec_prefix:   ${prefix}/usr
    bindir:        ${exec_prefix}/bin
    sbindir:       ${exec_prefix}/sbin
    libdir:        ${exec_prefix}/lib
    libexecdir:    ${exec_prefix}/lib/apache2/modules
    mandir:        ${exec_prefix}/share/man
    sysconfdir:    ${prefix}/etc/apache2
    datadir:       ${exec_prefix}/share/apache2
    iconsdir:      ${datadir}/icons
    htdocsdir:     ${prefix}/usr/share/apache2/default-site/htdocs
    manualdir:     ${htdocsdir}/manual
    cgidir:        ${prefix}/usr/lib/cgi-bin
    includedir:    ${exec_prefix}/include/apache2
    localstatedir: ${prefix}/var/lock/apache2
    runtimedir:    ${prefix}/var/run/apache2
    logfiledir:    ${prefix}/var/log/apache2
    proxycachedir: ${prefix}/var/cache/apache2/proxy
    infodir:       ${exec_prefix}/share/info
    installbuilddir: ${prefix}/usr/share/apache2/build
    errordir:      ${datadir}/error
&lt;/Layout&gt;
# Generic RPM layout
&lt;Layout RPM&gt;
    prefix:        /usr
    exec_prefix:   ${prefix}
    bindir:        ${prefix}/bin
    sbindir:       ${prefix}/sbin
    libdir:        ${prefix}/lib
    libexecdir:    ${libdir}/httpd/modules
    mandir:        ${prefix}/share/man
    sysconfdir:    /etc/httpd/conf
    installbuilddir: ${libdir}/httpd/build
    includedir:    ${prefix}/include/httpd
    localstatedir: /var
    datadir:       ${localstatedir}/www
    errordir:      ${datadir}/error
    iconsdir:      ${datadir}/icons
    htdocsdir:     ${datadir}/html
    manualdir:     ${datadir}/manual
    cgidir:        ${datadir}/cgi-bin
    runtimedir:    ${localstatedir}/run
    logfiledir:    ${localstatedir}/log/httpd
    proxycachedir: ${localstatedir}/cache/httpd/cache-root
&lt;/Layout&gt;
# AIX layout
&lt;Layout AIX&gt;
    prefix:        /opt/httpd
    exec_prefix:   /opt/httpd
    bindir:        ${exec_prefix}/bin
    sbindir:       ${exec_prefix}/sbin
    libdir:        ${exec_prefix}/lib
    libexecdir:    ${exec_prefix}/libexec
    mandir:        /usr/share/man
    sysconfdir:    /etc/httpd
    datadir:       /var/httpd
    installbuilddir: ${datadir}/build
    errordir:      ${datadir}/error
    htdocsdir:     ${datadir}/htdocs
    cgidir:        ${datadir}/cgi-bin
    iconsdir:      ${prefix}/icons
    manualdir:     ${prefix}/manual
    includedir:    ${prefix}/include
    localstatedir: /var/httpd
    runtimedir:    ${localstatedir}/run
    logfiledir:    ${localstatedir}/logs
    proxycachedir: ${localstatedir}/proxy
&lt;/Layout&gt;
# FHS layout
&lt;Layout Slackware-FHS&gt;
    prefix:          /usr
    exec_prefix:     ${prefix}
    bindir:          ${prefix}/bin
    sbindir:         ${prefix}/sbin
    libdir:          ${prefix}/lib/httpd
    libexecdir:      ${prefix}/lib/httpd/modules
    installbuilddir: ${prefix}/lib/httpd/build
    mandir:          ${prefix}/man
    sysconfdir:      /etc/httpd
    datadir:         /srv/httpd
    iconsdir:        ${datadir}/icons
    htdocsdir:       ${datadir}/htdocs
    manualdir:       ${htdocsdir}/manual
    cgidir:          ${datadir}/cgi-bin
    errordir:        ${datadir}/error
    includedir:      ${prefix}/include/httpd
    localstatedir:   /var
    runtimedir:      ${localstatedir}/run/httpd
    logfiledir:      ${localstatedir}/log/httpd
    proxycachedir:   ${localstatedir}/cache/httpd
&lt;/Layout&gt;
</code></pre>
<blockquote>
<p>安装目录微调</p>
</blockquote>
<pre><code class="shell">--bindir=DIR
    用户可执行目录dir
--datadir=DIR
    web服务器只读的体系无关数据目录DIR，虽然autoconf提供了该选项，但Apache并未使用它
--includedir=DIR
    Apache的头文件DIR
--infodir=DIR
    信息文档目录DIR 。虽然autoconf提供了该选项，但Apache并未使用它。
--libdir=DIR
--libexecdir=DIR
    程序可执行目录DIR，也就是动态加载模块目录。
--localstatedir=DIR
    可写的单一数据目录DIR。
--mandir=DIR
--oldincludedir=DIR
    非gcc的C头文件目录DIR
--sbindir=DIR
--sharedstatedir=DIR
    可写的体系无关数据目录DIR。
--sysconfdir=DIR
    配置文件目录，只读的单一数据目录DIR，用于存放httpd.conf和mime.types之类的服务器配置文件。
</code></pre>
</li>
<li><p>系统类型</p>
<blockquote>
<p>这些选项用于交叉编译在其他平台上运行的Apache HTTP服务器。在同一平台编译和运行Apache不需要使用这些选项。</p>
</blockquote>
<pre><code class="shell">--build=BUILD
    指定编译文件所在的系统类型BUILD
--host=HOST
    指定Apache HTTP服务器将要运行的目标系统类型HOST
--target=TARGET
</code></pre>
</li>
<li><p>模块选项</p>
<blockquote>
<p>有两种使用模块的方法:一是静态连接进核心，二是作为DSO模块动态加载;如果编译中包含任何DSO模块，则mod_so会被自动包含进核心。如果希望核心能够装载DSO，但不实际编译任何DSO模块，需指明”–enable-so=static”</p>
</blockquote>
<ul>
<li>一般语法:<ul>
<li>–disable-MODULE    禁用module模块<ul>
<li>–enable-MODULE=shared将MODULE编译为DSO(可用于所有模块)</li>
<li>–enable-MODULE=static将MODULE静态连接进核心(仅用于扩展和实验模块)</li>
<li>–enable-mod-shared=MODULE-LIST将MODULE-LIST中的所有模块都编译成DSO</li>
<li>–enable-modules=MODULES-LIST将MODULE-LIST静态连接进核心</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>上述MODULES-LIST可以是:</p>
<p>​    1.用引号并且用空格分割的模块列表</p>
<p>​        <code>--enable-mods-shared=&#39;headers rewrite dav&#39;</code></p>
<p>​    2.”<code>most</code>“(大多数模块［遇见错误模块时忽略该模块而不中断配置过程］)<br>​    3.”<code>all</code>“(所有模块［遇见错误模块时中断配置过程并报错］)</p>
<p>​            <code>--enable-mods-shared=most</code>    </p>
<p><strong>注意</strong>:configure将忽略MODULE和MODULE-LIST中的拼写错误，注意仔细拼写。用于MODULE和MODULE-LIST中的名称是”mod<em>NAME”中去掉”mod</em>“并将剩余部分中的下划线”_”替换为连字符”-“以后的结果，比如”mod_log_config”模块应当表示为”log-config”。</p>
<ul>
<li><p>多路处理模块(MPM)</p>
<p>必须有而且只能有一个MPM模块包含进核心，可以使用下面配置进行选择:</p>
<p>​    –with-mpm=MPM</p>
<p>​其中，MPM是你想要使用的多路处理模块的名字，如果不使用这个选项，将会使用默认,centos的默认MPM为prefork</p>
</li>
<li><p>第三方模块</p>
<p>有至少两种方法可以添加第三方模块，最简单的方法是作为配置参数提供，语法如下：</p>
<ul>
<li><p><code>--with-module=module-type:module-file[, module-type:module-file]</code></p>
<p><code>module-file</code>是模块的源代码文件名，该文件必须位于Apahe源代码目录树的”<code>modules/module-type</code>“目录下，如果<code>configure</code>没有在那里找到module-file ，则将它看作一个绝对路径名并尝试将其复制到”<code>modules/module-type</code>“目录中，如果”<code>modules/module-type</code>“目录不存在，<code>configure</code>将新建一个”<code>modules/module-type</code>“目录并在其中放置一个标准的<code>Makefile.in</code>文件。这种方法有两个明显的缺陷：模块的源代码必须是单一文件模块只能静态连接进核心，而不能作为DSO模块所以一般并不使用此方法，而是使用<code>apxs</code>(Apache扩展工具)来添加第三方模块支持。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>特殊程序包选项</p>
<ul>
<li><p>–with-apr=DIR</p>
</li>
<li><p>–with-apr-util=DIR</p>
</li>
<li><p>–with-ssl=DIR</p>
</li>
<li><p>–with-z=DIR</p>
<blockquote>
<p>如果你启用了压缩模块(比如<code>mod_deflate</code>)，<code>configure</code>脚本将会自动搜寻已经安装的<code>zlib</code>库，你可以在这里指定它的安装路径。</p>
</blockquote>
</li>
<li><p>–with-perl=DIR</p>
</li>
<li><p>–with-prcre=DIR</p>
</li>
<li><p>–with-ldap=DIR</p>
</li>
</ul>
</li>
<li><p>环境变量</p>
<ul>
<li>CC<br>  C编译器</li>
<li>CFLAGS<br>  C编译器的flags</li>
<li>CPP<br>  C预处理程序</li>
<li>CPPGLAGS<br>  C/C++预处理程序flags,比如使用”-Iincludedir”指定一个非标准的头文件目录includedir</li>
<li>LDFLAGS<br>  连接器flags<br>  ​</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shensir.info/2017/04/29/http-modules/" data-id="cjb072298000ugezuqh7qqg9r" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP/">HTTP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/modules/">modules</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-lvs-nat" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/20/lvs-nat/" class="article-date">
  <time datetime="2017-04-20T08:08:51.000Z" itemprop="datePublished">2017-04-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/20/lvs-nat/">Lvs-Nat</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Lvs-Nat"><a href="#Lvs-Nat" class="headerlink" title="Lvs-Nat"></a>Lvs-Nat</h1><p><strong>实验拓扑</strong></p>
<p><img src="C:\Users\pc\Desktop\lvs-nat.png" alt="lvs-nat"></p>
<p><strong>配置</strong></p>
<ul>
<li><p>RS</p>
<pre><code>iptables -F
setenforce 0
yum install httpd php -y
echo 119 &gt; /var/www/html/1.html
120
echo 120 &gt; /var/www/html/1.html
</code></pre></li>
<li><p>Director 1</p>
<pre><code>iptables -F
setenforce 0
echo 1 &gt; /proc/sys/net/ipv4/ip_forward
yum -y install keepalived
#配置文件
! Configuration File for keepalived
global_defs {
   notification_email {
     sysadmin@firewall.loc
   }
   notification_email_from Alexandre.Cassen@firewall.loc
   smtp_server 192.168.200.1
   smtp_connect_timeout 30
   router_id dr1
   vrrp_mcast_group4 224.0.0.50  广播地址
}
vrrp_instance mvr {
    state MASTER #指定Keepalived的角色，MASTER为主服务器，BACKUP为备用服务器
    interface ens33
    virtual_router_id 50  #虚拟路由标识(1-255)，在一个VRRP实例中主备服务器ID必须一样
    priority 100  #优先级
    advert_int 1  #设置主备之间同步检查时间间隔，单位秒
    authentication { #认证，以一个VRRP实例中主备服务器pass必须一致
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        172.18.50.100/16 dev ens33
    }
}
vrrp_instance mvr1  {
    state MASTER
    interface ens38
    virtual_router_id 51
    priority 100
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1a111
    }
    virtual_ipaddress {
        192.168.50.100/24 dev ens38
    }
}
virtual_server 172.18.50.100 80 { #设置虚拟服务器
    delay_loop 6     #服务轮询的时间间隔
    lb_algo rr          # rr|wrr|lc|wlc|lblc|sh|dh：定义调度方法
    lb_kind NAT         # NAT|DR|TUN：集群的类型
    nat_mask 255.255.0.0
    persistence_timeout 0 #持久时间时长 单位为s
    protocol TCP

    real_server 192.168.50.119 80 {
        weight 1
        HTTP_GET {   #设置检测方式
            url {
              path /1.html
              status_code 200 #设定返回状态码为200表示Realserver存活
            } 
            connect_timeout 3 #设置响应超时时间
            nb_get_retry 3      #设置超时重试次数
            delay_before_retry 3     #设置超时重试间隔
        }   
}
    real_server 192.168.50.120 80 {
        weight 1
        HTTP_GET {
            url {
              path /1.html
              status_code 200
            } 
            connect_timeout 3
            nb_get_retry 3
            delay_before_retry 3
}
}
}
</code></pre></li>
<li><p>Director 2</p>
<pre><code>! Configuration File for keepalived
global_defs {
   notification_email {
     sysadmin@firewall.loc
   }
   notification_email_from Alexandre.Cassen@firewall.loc
   smtp_server 192.168.200.1
   smtp_connect_timeout 30
   router_id dr2
   vrrp_mcast_group4 224.0.0.50
}
vrrp_instance mvr {
    state BACKUP
    interface ens33
    virtual_router_id 50
    priority 98
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        172.18.50.100/16 dev ens33
    }
    notify_master &quot;/root/keepalived.sh master&quot;
    notify_backup &quot;/root/keepalived.sh backup&quot;
    notify_fault &quot;/root/keepalived.sh fault&quot;
}
vrrp_instance mvr1 {
    state BACKUP
    interface ens38
    virtual_router_id 51
    priority 98
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1a111
    }
    virtual_ipaddress {
        192.168.50.100/24 dev ens38
    }
    notify_master &quot;/root/keepalived.sh master&quot;
        notify_backup &quot;/root/keepalived.sh backup&quot;
    notify_fault &quot;/root/keepalived.sh fault&quot;

}
virtual_server 172.18.50.100 80 {
    delay_loop 6
    lb_algo rr
    lb_kind NAT
    nat_mask 255.255.0.0
    persistence_timeout 0
    protocol TCP

    real_server 192.168.50.119 80 {
        weight 1
        HTTP_GET {
            url {
              path /1.html
              status_code 200
            } 
            connect_timeout 3
            nb_get_retry 3
            delay_before_retry 3
        }
}
    real_server 192.168.50.120 80 {
        weight 1
        HTTP_GET {
            url {
              path /1.html
              status_code 200
            } 
            connect_timeout 3
            nb_get_retry 3
            delay_before_retry 3
        }
}
}
</code></pre><p>​</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shensir.info/2017/04/20/lvs-nat/" data-id="cjb07229i001mgezukhhxvtvi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Http/">Http</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Https/">Https</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-http-ca" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/20/http-ca/" class="article-date">
  <time datetime="2017-04-20T08:08:51.000Z" itemprop="datePublished">2017-04-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/20/http-ca/">Http two</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="HTTP2"><a href="#HTTP2" class="headerlink" title="HTTP2"></a>HTTP2</h2><h4 id="Curl"><a href="#Curl" class="headerlink" title="Curl"></a><strong>Curl</strong></h4><blockquote>
<p>基于URL语法在命令行方式下工作多文件传输工具</p>
</blockquote>
<p><strong>一些选项</strong></p>
<ul>
<li>-A/–user-agent <string>    设置用户代理</string></li>
<li>–basic   使用http基本验证</li>
<li>–tcp-nodelay  使用TCP_NODELAY</li>
<li>-e/–referer <url> 来源网址</url></li>
<li>–cacert <file> ssl</file></li>
<li>–compressed  要求返回的是压缩多形势</li>
<li>-H/–header <line></line> 自定义头信息</li>
<li>-I/–head  只显示响应报文首部信息</li>
<li>–limit-rate <rate>  设置传输速度</rate></li>
<li>-u/–user <user[:password]> 设置服务器多用户和密码</user[:password]></li>
<li>-m  设置最大传输时间</li>
<li>-k 　不使用证书</li>
</ul>
<p>eg: curl -I -m 5 -o /dev/null -s -w %{http_code} www.baidu.com</p>
<p><strong>mod_deflate模块</strong></p>
<ul>
<li><p>LoadModule deflate_module modules/mod_deflate.so</p>
</li>
<li><p>节省带宽，传输前对资源进行压缩</p>
</li>
<li><p>配置</p>
<blockquote>
<p>vim +$ /etc/httpd/conf/httpd.conf</p>
<p>SetOutputFilter DEFLATE<br>AddOutPutFilterByType DEFLATE text/html text/plain text/css text/xml text/javascript application/xhtml+xml</p>
</blockquote>
</li>
<li><p>可以用浏览器f12测试</p>
</li>
</ul>
<p><strong>Https</strong></p>
<ul>
<li><p>CA端</p>
<pre><code class="SHELL">cd /etc/pki/CA
(umask 077;openssl genrsa -out  private/cakey.pem 2048)
openssl req -new -x509 -key private/cakey.pem -out cacert.pem
touch serial index.txt
echo 01 &gt; serial
</code></pre>
</li>
<li><p>Http端</p>
<pre><code class="shell">cd /etc/httpd
mkdir ssl
cd ssl
(umask 077;openssl genrsa -out httpd.key 1024)
openssl req -new -key httpd.key -out httpd.csr
</code></pre>
<blockquote>
<p>将生成多csr发送至CA</p>
</blockquote>
</li>
<li><p>颁发</p>
<pre><code class="shell">open ca -in httpd.csr -out /etc/pki/CA/certs/httpd.crt
</code></pre>
<blockquote>
<p>将生成多证书发送给http服务器</p>
</blockquote>
</li>
<li><p>安装ssl模块</p>
<pre><code class="shell">yum install mod_ssl
httpd -M | grep ssl
vim /etc/httpd/conf.d/ssl.conf
SSLCertificateFile /etc/httpd/ssl/httpd.crt
SSLCertificateKeyFile /etc/httpd/ssl/httpd.key
</code></pre>
</li>
</ul>
<p><strong>Http自带工具</strong></p>
<ul>
<li><p>Httpasswd</p>
<blockquote>
<p>basic认证基于文件实现时，用到多帐号文件生成工具</p>
</blockquote>
</li>
<li><p>Apachectl</p>
<blockquote>
<p>httpd自带多服务控制脚本，支持start和stop</p>
</blockquote>
</li>
<li><p>Apxs</p>
<blockquote>
<p>由httpd-devel包提供，扩展Http使用第三方模块的工具</p>
</blockquote>
</li>
<li><p>Rotatelogs</p>
<blockquote>
<p>日志滚动工具</p>
</blockquote>
</li>
<li><p>Suexec</p>
<blockquote>
<p>访问某些有特殊权限配置的资源，临时切换至用户身份运行</p>
</blockquote>
</li>
<li><p>Ab</p>
</li>
</ul>
<p><strong>Http2.4新模块</strong></p>
<ul>
<li>mod_proxy_fcgi    支持PHP等动态语言</li>
<li>mod_proxy_scgi SCGI protocol  支持python</li>
<li>mod_remoteip  获取远端真实访问ip</li>
</ul>
<p><strong>Http Reponse报文的语法格式</strong></p>
<ul>
<li><p>version Http协议版本，HTTP/\<major>.\<minor></minor></major></p>
</li>
<li><p>status  响应状态码，标记请求过程中所发生的情况</p>
</li>
<li><p>reason-phrase  原因短语，状态码所标记状态多详细版本</p>
</li>
<li><p>hearders  用来标记请求和响应属性</p>
</li>
<li><p>entity-bady  响应主体部分，响应时候附加数据</p>
</li>
<li><p>格式</p>
<blockquote>
<p>version status reason-phrase</p>
<p>headers</p>
<p>entity-body</p>
</blockquote>
</li>
</ul>
<p><strong>常见多Method的方法</strong></p>
<ul>
<li>GET:从服务器获取一个资源</li>
<li>HEAD:只从服务器获取文档响应首部</li>
<li>POST:向服务器发送要处理多数据，放在请求报文的\<entity-body>中</entity-body></li>
<li>PUT:与post相反，将请求的主体部分存储在服务器上</li>
<li>DELETE:请求删除服务器上指定的文档</li>
<li>TRACE:追踪请求到达服务器中间经过的代理服务器</li>
<li>OPTIONS:请求服务器返回对追定资源支持使用多请求方法</li>
</ul>
<p><strong>状态码分类</strong></p>
<ul>
<li>1xx:100-101 额外信息提示</li>
<li>2xx:200-206 表示成功类响应</li>
<li>3xx:300-305 重定向</li>
<li>4xx:400-415 错误类响应码，由于客户端发生错误，如客户端请求一个根本不存在的资源</li>
<li>5xx:500-505 错误类信息，服务器端错误，服务器本身一些问题导致请求无法成功</li>
</ul>
<p><strong>状态码的分类</strong></p>
<ul>
<li>200    请求成功 OK</li>
<li>301  永久重定向  Moved Permanently</li>
<li>302  临时重定向  Found</li>
<li>304  请求资源未发生改变 Not Modified</li>
<li>401  输入帐号和密码认证之后才能访问资源</li>
<li>403  请求被禁止 Fornodden</li>
<li>404  服务无法找到客户端请求多资源  </li>
<li>500  服务器内部错误 Internal Server Error</li>
<li>502  代理服务器从后端服务器收到一条伪响应 bad gateway</li>
</ul>
<p>  ​</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shensir.info/2017/04/20/http-ca/" data-id="cjb072295000pgezue8j5hoix" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Http/">Http</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Https/">Https</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-httpd-notes" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/20/httpd-notes/" class="article-date">
  <time datetime="2017-04-20T01:54:53.000Z" itemprop="datePublished">2017-04-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/20/httpd-notes/">httpd常见指令及其配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="HTTPD"><a href="#HTTPD" class="headerlink" title="HTTPD"></a>HTTPD</h2><p><strong>Apache常用的配置指令</strong></p>
<ul>
<li><p>ServerTokens Http响应头，默认会包含apache详细版本号及php版本号</p>
<ul>
<li><p>语法：</p>
<blockquote>
<p>ServerTokens Major|Min|Pord|OS|Full</p>
</blockquote>
</li>
<li><p>默认值为 ServerToken OS</p>
</li>
<li><p>模块 core,这个指令控制服务器回应给客户端的＂Server:”应答头是否包含关于服务器操作系统和编译进的模块描述信息．</p>
</li>
</ul>
</li>
<li><p>ServerRoot “/etc/httpd”　指明配置文件存放多位置</p>
</li>
<li><p>DocumentRoot  网页根目录</p>
</li>
<li><p>ServerName www.test.com:80</p>
<blockquote>
<p>定义网站域名</p>
<p>需要借助DNS将域名解析到服务器IP</p>
</blockquote>
</li>
<li><p>AddDefaultCharset UTF-8|GBK|GB2312|GB18030 设定默认字符集</p>
<p>​</p>
</li>
</ul>
<p><strong>Http请求处理多连接访问</strong></p>
<ul>
<li><p>非保持连接(短连接)</p>
<blockquote>
<p>对于大量并发场景中，短连接多三次握手以及四次挥手会占据大量带宽</p>
</blockquote>
</li>
<li><p>保持连接(长连接) Keep-alive</p>
<blockquote>
<p>避免过多多连接保持，可以从时间和数量两个维度对长连接加以限制,Http2.4支持毫秒级别多限制</p>
</blockquote>
<p><strong>三个参数</strong></p>
<ul>
<li>KeepAlive On|Off</li>
<li>KeepAlive Timeout  15</li>
<li>MaxKeepAliveRequests 100</li>
</ul>
<p><strong>用Telnet测试</strong></p>
<pre><code class="shell">[root@test ~]# telnet 127.0.0.1 80
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is &#39;^]&#39;.
GET / HTTP/1.1
Host:172.18.50.61

HTTP/1.1 200 OK
Date: Thu, 20 Apr 2017 02:45:55 GMT
Server: Apache
Last-Modified: Thu, 20 Apr 2017 02:16:22 GMT
ETag: &quot;24bf8-5-54d8fba2fe78d&quot;
Accept-Ranges: bytes
Content-Length: 5
Content-Type: text/html; charset=UTF-8

test
Connection closed by foreign host.
</code></pre>
</li>
</ul>
<p><strong>MPM详细配置</strong></p>
<ul>
<li>查看Httpd程序多模块列表<ul>
<li>httpd -l　查看静态编译多模块</li>
<li>httpd -M 查看静态编译及动态编译多模块</li>
</ul>
</li>
</ul>
<pre><code class="shell">[root@test ~]# httpd -M | grep prefork
httpd: Could not reliably determine the server&#39;s fully qualified domain name, using test.com for ServerName
 mpm_prefork_module (static)
Syntax OK
</code></pre>
<blockquote>
<p>在apache2.2中,MPM模块不支持动态装卸载</p>
</blockquote>
<ul>
<li><p>prefork</p>
<pre><code class="shell">&lt;IfModule prefork.c&gt;
StartServers       8        服务进程启动时启动多少个空闲进程
MinSpareServers    5        最少空闲进程数，如果少于５，主控进程会再启动几个，使空闲进程到达5
MaxSpareServers   20        最大空闲进程数，如果到达20,则会被回收
ServerLimit      256        所允许启动的最大在线进程数
MaxClients       256        最大允许启动进程数量响应用户请求
MaxRequestsPerChild  4000　　每个进程最多可以处理多少个请求，超过则销毁
&lt;/IfModule&gt;
</code></pre>
</li>
</ul>
<ul>
<li><p>woker</p>
<pre><code class="shell">&lt;IfModule worker.c&gt;
StartServers         4        服务器启动是启动多少个空闲进程
MaxClients         300        最大并发响应数量
MinSpareThreads     25        最小空闲线程
MaxSpareThreads     75        最大空闲线程
ThreadsPerChild     25        每个进程启动25个线程
MaxRequestsPerChild  0        每个进程可以处理无限个请求
&lt;/IfModule&gt;
</code></pre>
</li>
<li><p>event</p>
</li>
</ul>
<blockquote>
<p>Centos 6上同时提供了三个二进制文件(/usr/sbin/httpd  /usr/sbin/httpd.event  /usr/sbin/httpd.worker)，分别对应不同多MPM支持，默认使用prefork,可以使用http -l查看</p>
<p>可以通过修改/etc/sysconfig/httpd的HTTPD=/usr/sbin/httpd.worker切换MPM</p>
</blockquote>
<p><strong>DOS动态装卸载</strong></p>
<ul>
<li><p>LoadModule <mod_name><mod_path></mod_path></mod_name></p>
<blockquote>
<p>模块文件路径使用相对路径</p>
</blockquote>
</li>
</ul>
<p><strong>Http站点访问控制</strong></p>
<pre><code>* 文件系统/URL路径

  \&lt;Directory &quot;/var/www/html&quot;&gt;

  ...

  \&lt;/Directory&gt;

  ​

  \&lt;File &quot; &quot;&gt;

  ...

  \&lt;/File&gt;

  ​

  \&lt;FileMatch &quot;PATTERN&quot;&gt;

  ...

  \&lt;/FileMatch&gt;
</code></pre><blockquote>
<p>使用正则表达式模式匹配</p>
<p>\<location ""=""></location></p>
<p>…</p>
<p>\</p>
</blockquote>
<ul>
<li><p>Options Indexes FollowSymlinks</p>
<blockquote>
<p>Options定义此目录内资源访问的特性，控制被定义多目录下所指定多各种资源多被访问模式，后跟一个或多个空白字符分割多选项列表</p>
<p>indexs指明多URL路径不存在与定义多主页面资源相符的资源文件时候，返回索引列表给用户，目录浏览功能，一般关掉</p>
<p>FollowSymlinks 允许跟踪符号连接文件所指向的源文件</p>
<p>跟踪符号链接，如果目录下存在软连接，则可以访问软连接指向多文件</p>
<p>Includes     //允许启用服务端包含</p>
<p>SymLinlifOwnerMatch        //源文件和链接多目标文件多属主属组相同多时候才允许跟踪访问</p>
<p>ExecCGI        //允许执行CGI脚本</p>
<p>MultiViews        //允许执行内容协商</p>
<p>None        //全部都不</p>
<p>ALL            //所有都</p>
<p>AllowOverride    //与访问控制相关的那些执行可以放在.htacesss文件中，每个目录下都可以有一个，但是使用.htacess会使网站对目录多资源解析变多非常慢，不推荐使用。</p>
</blockquote>
</li>
<li><p>基于源地址定义访问规则</p>
<blockquote>
<p>Order    allow,deny</p>
<p>ALlow    for    all</p>
<p>Order定义生效法则，写在后面表示默认法则</p>
<p>Allow from all，Deny from 来源ip或者网络地址</p>
<p>示例:</p>
<p>​    Order allow,deny</p>
<p>​    Deny from 172.18.100.1</p>
<p>​    allow form 172.18</p>
<p>仅仅允许172.18除了100.1的地址访问</p>
<p>​</p>
<p>目录别名</p>
<p>vim /etc/httpd/conf/httpd.conf</p>
<p>/Alias后加</p>
<p>Alias /aa/ “var/www/html/bb/“</p>
<p>后面必须为绝对路径</p>
</blockquote>
</li>
</ul>
<p><strong>Http日志相关设定</strong></p>
<ul>
<li><p>错误日志</p>
<blockquote>
<p>定义: ErrorLog logs/error_log</p>
</blockquote>
</li>
<li><p>错误日志级别</p>
<ul>
<li>debug    所有信息，只要产生就全部记录</li>
<li>info         所有多信息数据</li>
<li>notice     引起注意</li>
<li>warn       警告</li>
<li>error       发生错误</li>
<li>crit           级别很严重</li>
<li>alert         红色警戒</li>
<li>emerg      引起恐慌</li>
</ul>
</li>
<li><p>访问日志</p>
<blockquote>
<p>定义 CustomLog logs/access_log combined</p>
<p>格式 日志路径 日志格式{combined|common|referer|agent}</p>
<p>日志格式定义</p>
<blockquote>
<p>LogFormat “%h %l %u %t \”%r\” %&gt;s %b \”%{Referer}i\” \”%{User-Agent}i\”” combined<br>LogFormat “%h %l %u %t \”%r\” %&gt;s %b” common<br>LogFormat “%{Referer}i -&gt; %U” referer<br>LogFormat “%{User-agent}i” agent</p>
</blockquote>
<p>“%h %l %u”可以称为宏或者是通配符</p>
<p>日志格式示例</p>
<p>172.18.100.7 - - [20/Apr/2017:14:58:02 +0800] “GET /a/ HTTP/1.1” 404 262 “-“ “Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0”</p>
<p>客户端地址 登录名 认证名 时间 请求首部 状态吗 响应报文大小 从那个页面跳过来 浏览器类型</p>
</blockquote>
</li>
</ul>
<p><strong>基于用户的访问控制</strong></p>
<ul>
<li><p>常见多用户认证方式</p>
<blockquote>
<p>http协议自身提供多认证(明文)–&gt;basic 明文认证</p>
<p>表单认证–&gt;digest消息摘要认证</p>
</blockquote>
</li>
<li><p>认证质询</p>
<blockquote>
<p>www-authenticate</p>
<p>​    响应码为401,拒绝客户端请求，并说明要求提供客户端帐号密码</p>
<p>authorization    </p>
<p>​    客户端用户填入帐号密码后再次发送请求报文，认证通过时，则服务器发送响应多资源</p>
<p>安全域，需要用户认证后才能访问多路径。应该通过名称对其进行标识，以便告知用户认证多原因</p>
<p>用户帐号密码存放多位置</p>
<p>​    虚拟帐号:仅用于访问某服务时用到多认证标识</p>
<p>​    存储: 文本文件、sql数据库、LDAP轻量级目录访问协议</p>
</blockquote>
</li>
<li><p>Basic认证配置步骤</p>
<blockquote>
<directiry ""="">

<p>AuthType Basic<br>AuthName “String”<br>AuthUserFile “/PATH/TO/HTTPD_USER_PASSWD_FILE”</p>
<p># AuthGroupFile “/PATH/TO/HTTPD_GROUP_FILE” #基于组来认证<br>Require user username1 username2…</p>
<p># Require group grpname1 grpname2 …</p>
<p></p>
<p>示例:</p>
<blockquote>
<directory "="" data="" www=""><br>Options None<br>AllowOverride None<br>AuthType Basic<br>AuthName “Admin Realm,show something”<br>AuthUserFile “/etc/httpd/conf/.htpasswd”<br>Require user tom<br><br># Require user vaild-user //允许所有用户登录<br><br></directory>

</blockquote>
<p>新建密码文件</p>
<p>htpasswd -c -m /etc/httpd/conf/.htpasswd</p>
<p>​    -c 第一次创建密码文件时使用</p>
<p>​    -m md5</p>
<p>​    -s force sha encrypt the password</p>
<p>​    -D delete the spacifien user</p>
</directiry></blockquote>
</li>
</ul>
<p><strong>Http虚拟主机</strong></p>
<ul>
<li><p>实现方式</p>
<ul>
<li>基于ip</li>
<li>基于port</li>
<li>基于FQDN</li>
</ul>
</li>
<li><p>配置</p>
<ul>
<li><p>注释DocumentRoot指令，禁用Main主机</p>
</li>
<li><p>配置语法</p>
<blockquote>
<virtualhost ip:port=""><br><br>​    ServerName FQDN<br><br>​    DocumentRoot “ “ //站点路径<br><br></virtualhost>

<p>可用的指令</p>
<p>​    ServerAlias           虚拟主机的别名</p>
<p>​    Errorlog            </p>
<p>​    CustomLog        日志</p>
<p>​    <directory ""=""> ..</directory></p>
</blockquote>
</li>
<li><p>示例</p>
<pre><code class="shell">&lt;VirtualHost 172.18.50.61:80&gt;
    DocumentRoot /data/www/a
&lt;/VirtualHost&gt;

&lt;VirtualHost 172.18.50.61:800&gt;
    DocumentRoot /data/www/b
&lt;/VirtualHost&gt;
</code></pre>
</li>
</ul>
</li>
</ul>
<p><strong>Http状态页面</strong></p>
<ul>
<li><p>开启status模块</p>
<blockquote>
<p>LoadModule status_module modules/mod_status.so</p>
</blockquote>
</li>
<li><p>启动状态访问页面</p>
<blockquote>
<location server-status=""><br><br>    SetHandler server-status<br>    Order deny,allow<br>    Allow from all<br>    Allow from .example.com<br></location>
</blockquote>
</li>
<li><p>工作进程状态</p>
<ul>
<li>- 等待连接请求</li>
<li>Ｗ正处于工作状态　发送响应报文进程</li>
<li>S  正在创建</li>
<li>R 正在读取请求</li>
<li>K 正在保持连接</li>
<li>D 正在执行DNS查询</li>
<li>C 正在关闭连接</li>
<li>L 正在记录日志</li>
<li>G 正在优雅多关闭</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shensir.info/2017/04/20/httpd-notes/" data-id="cjb07229a0011gezue95695pr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Httpd/">Httpd</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/">web</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-dropbear" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/18/dropbear/" class="article-date">
  <time datetime="2017-04-18T12:14:08.000Z" itemprop="datePublished">2017-04-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/18/dropbear/">dropbear编译安装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="编译安装dropbear"><a href="#编译安装dropbear" class="headerlink" title="编译安装dropbear"></a>编译安装dropbear</h1><p><strong>安装准备</strong></p>
<ol>
<li>安装Development tools</li>
<li>tar xvf dropbear.tar.bzip2</li>
</ol>
<p><strong>编译安装</strong></p>
<ol>
<li>./configure –prefix=/usr/local/dropbear –sysconfdir=/etc/dropbear</li>
<li>make &amp;&amp; make install</li>
</ol>
<p><strong>生成公钥并启动服务</strong></p>
<ol>
<li>/usr/local/dropbear/bin/dropbearkey -t rsa|dss|ecdsa -f /etc/dropbear/dropbear_rsa_host_key -s 2048</li>
<li>dropbear -p 2222 -F -E 前台运行</li>
<li>dropbear -p 2222 后台</li>
</ol>
<p><strong>测试</strong></p>
<blockquote>
<p>ssh -p 2222 root@ip_address</p>
<p>dbclient -p 2222 root@ip_address</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shensir.info/2017/04/18/dropbear/" data-id="cjb072294000ogezuxf3izhjl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP-HEADER/">HTTP HEADER</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Haproxy/">Haproxy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Keepalived/">Keepalived</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tomcat/">Tomcat</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ca/">Ca</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fastdfs/">Fastdfs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP-HEADER/">HTTP HEADER</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Haproxy/">Haproxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Http/">Http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Httpd/">Httpd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Https/">Https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Iptables/">Iptables</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Keepalived/">Keepalived</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Maradb/">Maradb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mariadb/">Mariadb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MogileFS/">MogileFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Notes/">Notes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ProxySQL/">ProxySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bind/">bind</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/keepalived/">keepalived</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lvs/">lvs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/modules/">modules</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nfs/">nfs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/session/">session</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/中间件/">中间件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/主从复制/">主从复制</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式文件系统/">分布式文件系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/基础命令/">基础命令</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文件共享/">文件共享</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/负载均衡/">负载均衡</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Ca/" style="font-size: 10px;">Ca</a> <a href="/tags/Fastdfs/" style="font-size: 10px;">Fastdfs</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/HTTP-HEADER/" style="font-size: 10px;">HTTP HEADER</a> <a href="/tags/Haproxy/" style="font-size: 10px;">Haproxy</a> <a href="/tags/Http/" style="font-size: 13.33px;">Http</a> <a href="/tags/Httpd/" style="font-size: 10px;">Httpd</a> <a href="/tags/Https/" style="font-size: 13.33px;">Https</a> <a href="/tags/Iptables/" style="font-size: 10px;">Iptables</a> <a href="/tags/Keepalived/" style="font-size: 10px;">Keepalived</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/Maradb/" style="font-size: 10px;">Maradb</a> <a href="/tags/Mariadb/" style="font-size: 13.33px;">Mariadb</a> <a href="/tags/MogileFS/" style="font-size: 10px;">MogileFS</a> <a href="/tags/Notes/" style="font-size: 13.33px;">Notes</a> <a href="/tags/ProxySQL/" style="font-size: 10px;">ProxySQL</a> <a href="/tags/bind/" style="font-size: 10px;">bind</a> <a href="/tags/keepalived/" style="font-size: 13.33px;">keepalived</a> <a href="/tags/linux/" style="font-size: 16.67px;">linux</a> <a href="/tags/lvs/" style="font-size: 10px;">lvs</a> <a href="/tags/modules/" style="font-size: 10px;">modules</a> <a href="/tags/nfs/" style="font-size: 10px;">nfs</a> <a href="/tags/nginx/" style="font-size: 13.33px;">nginx</a> <a href="/tags/session/" style="font-size: 10px;">session</a> <a href="/tags/web/" style="font-size: 13.33px;">web</a> <a href="/tags/中间件/" style="font-size: 10px;">中间件</a> <a href="/tags/主从复制/" style="font-size: 10px;">主从复制</a> <a href="/tags/分布式文件系统/" style="font-size: 10px;">分布式文件系统</a> <a href="/tags/基础命令/" style="font-size: 10px;">基础命令</a> <a href="/tags/文件共享/" style="font-size: 10px;">文件共享</a> <a href="/tags/负载均衡/" style="font-size: 13.33px;">负载均衡</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/06/12/Fastdfs安装配置/">Fastdfs安装配置</a>
          </li>
        
          <li>
            <a href="/2017/06/12/Maradb主从复制/">Maradb主从复制</a>
          </li>
        
          <li>
            <a href="/2017/06/12/Mariadb半同步复制及复制过滤器/">Mariadb半同步复制及复制过滤器</a>
          </li>
        
          <li>
            <a href="/2017/06/12/MogileFS的安装配置/">MogileFS的安装配置</a>
          </li>
        
          <li>
            <a href="/2017/06/12/Maradb主主复制/">Maradb主主复制</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Pursuit<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>