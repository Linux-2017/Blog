{"title":"Maradb主主复制","slug":"Maradb主主复制","date":"2017-06-12T13:28:08.000Z","updated":"2017-11-19T13:15:37.000Z","comments":true,"excerpt":"","content":"<h2 id=\"Maradb主主复制\"><a href=\"#Maradb主主复制\" class=\"headerlink\" title=\"Maradb主主复制\"></a>Maradb主主复制</h2><blockquote>\n<p>互为主从：两个节点各自都要开启binlog和relay log；</p>\n</blockquote>\n<ol>\n<li>数据不一致；</li>\n<li>自动增长id；</li>\n</ol>\n<p><strong>定义一个节点使用奇数id</strong></p>\n<pre><code>auto_increment_offset=1\nauto_increment_increment=2\n</code></pre><p><strong>定义一个节点使用偶数id</strong></p>\n<pre><code>auto_increment_offset=2\nauto_increment_increment=2\n</code></pre><h4 id=\"MASTER1-172-18-50-72\"><a href=\"#MASTER1-172-18-50-72\" class=\"headerlink\" title=\"MASTER1(172.18.50.72)\"></a>MASTER1(172.18.50.72)</h4><p>/etc/my.cnf.d/server.cnf添加</p>\n<pre><code>innodb_file_per_table=ON\nskip_name_resolve=ON\nlog_bin=mysql-bin\nserver_id=1\nrelay_log=relay-log\nauto_increment_offset=1\nauto_increment_increment=2\n</code></pre><p>授权slave服务器</p>\n<pre><code>GRANT REPLICATION SLAVE,REPLICATION CLIENT ON *.* TO test@&#39;172.18.50.73&#39; IDENTIFIED BY &#39;test123&#39;;\n</code></pre><p>查看二进制文件</p>\n<pre><code>MariaDB [(none)]&gt; SHOW MASTER STATUS;\n+------------------+----------+--------------+------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |\n+------------------+----------+--------------+------------------+\n| mysql-bin.000003 |      491 |              |                  |\n+------------------+----------+--------------+------------------+\n</code></pre><p>同步参数配置</p>\n<pre><code>CHANGE MASTER TO MASTER_HOST=&#39;172.18.50.73&#39;,MASTER_USER=&#39;test&#39;,MASTER_PASSWORD=&#39;test123&#39;,MASTER_LOG_FILE=&#39;mysql-bin.000003&#39;,MASTER_LOG_POS=491;\n</code></pre><p>开启slave</p>\n<pre><code>START SLAVE;\n</code></pre><h4 id=\"MASTER2-172-18-50-73\"><a href=\"#MASTER2-172-18-50-73\" class=\"headerlink\" title=\"MASTER2(172.18.50.73)\"></a>MASTER2(172.18.50.73)</h4><p>/etc/my.cnf.d/server.cnf添加</p>\n<pre><code>innodb_file_per_table=ON\nskip_name_resolve=ON\nlog_bin=mysql-bin\nserver_id=2\nrelay_log=relay-log\nauto_increment_offset=2\nauto_increment_increment=2\n</code></pre><p>授权slave服务器</p>\n<pre><code>GRANT REPLICATION SLAVE,REPLICATION CLIENT ON *.* TO test@&#39;172.18.50.72&#39; IDENTIFIED BY &#39;test123&#39;;\n</code></pre><p>查看二进制文件</p>\n<pre><code>MariaDB [(none)]&gt; SHOW MASTER STATUS;\n+------------------+----------+--------------+------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |\n+------------------+----------+--------------+------------------+\n| mysql-bin.000003 |      491 |              |                  |\n+------------------+----------+--------------+------------------+\n</code></pre><p>同步参数配置</p>\n<pre><code>CHANGE MASTER TO MASTER_HOST=&#39;172.18.50.72&#39;,MASTER_USER=&#39;test&#39;,MASTER_PASSWORD=&#39;test123&#39;,MASTER_LOG_FILE=&#39;mysql-bin.000003&#39;,MASTER_LOG_POS=491;\n</code></pre><p>开启slave</p>\n<pre><code>START SLAVE;\n</code></pre><h4 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h4><p>MASTER1</p>\n<pre><code>CREATE TABLE tbl1 (id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,name VARCHAR(20));\ninsert into tbl1 (name) VALUES (&#39;a1&#39;),(&#39;a2&#39;);\n</code></pre><p>MASTER2</p>\n<pre><code>insert into tbl1 (name) VALUES (&#39;a1&#39;),(&#39;a2&#39;);\nMariaDB [mytest]&gt; select * from tbl1;\n+----+------+\n| id | name |\n+----+------+\n|  1 | a1   |\n|  3 | a2   |\n|  4 | a1   |\n|  6 | a2   |\n+----+------+\n</code></pre>","categories":[],"tags":[{"name":"Maradb","path":"api/tags/Maradb.json"}]}