{"title":"Maradb主从复制","slug":"Maradb主从复制","date":"2017-06-12T13:28:08.000Z","updated":"2017-11-19T13:15:37.000Z","comments":true,"excerpt":"","content":"<h2 id=\"Maradb主从复制\"><a href=\"#Maradb主从复制\" class=\"headerlink\" title=\"Maradb主从复制\"></a>Maradb主从复制</h2><h4 id=\"MASTER-172-18-50-72\"><a href=\"#MASTER-172-18-50-72\" class=\"headerlink\" title=\"MASTER(172.18.50.72)\"></a>MASTER(172.18.50.72)</h4><p>vim /etc/my.cnf.d/server.cnf添加</p>\n<pre><code>innodb_file_per_table=ON\nskip_name_resolve=ON\nlog_bin=mysql-bin\nserver_id=1\n</code></pre><p>授权slave服务器</p>\n<pre><code>GRANT REPLICATION SLAVE,REPLICATION CLIENT ON *.* TO test@&#39;172.18.50.73&#39; IDENTIFIED BY &#39;test123&#39;;\n</code></pre><p>查看二进制文件</p>\n<pre><code>MariaDB [(none)]&gt; SHOW MASTER STATUS;\n+------------------+----------+--------------+------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |\n+------------------+----------+--------------+------------------+\n| mysql-bin.000005 |      503 |              |                  |\n+------------------+----------+--------------+------------------+\nMariaDB [(none)]&gt; SHOW BINARY LOGS;\n+------------------+-----------+\n| Log_name         | File_size |\n+------------------+-----------+\n| mysql-bin.000001 |       288 |\n| mysql-bin.000002 |       848 |\n| mysql-bin.000003 |      1629 |\n| mysql-bin.000004 |       811 |\n| mysql-bin.000005 |       503 |\n+------------------+-----------+\n5 rows in set (0.00 sec)\n</code></pre><h4 id=\"SLAVE-172-18-50-73\"><a href=\"#SLAVE-172-18-50-73\" class=\"headerlink\" title=\"SLAVE(172.18.50.73)\"></a>SLAVE(172.18.50.73)</h4><p>在/etc/my.cnf.d/server.cnf中加入</p>\n<pre><code>[mysqld]\nskip_name_resolve=ON\ninnodb_file_per_table=ON\nserver_id=2\nrelay_log=relay-log\n</code></pre><p>授权</p>\n<pre><code>CHANGE MASTER TO MASTER_HOST=&#39;172.18.50.72&#39;,MASTER_USER=&#39;test&#39;,MASTER_PASSWORD=&#39;test123&#39;,MASTER_LOG_FILE=&#39;mysql-bin.000005&#39;,MASTER_LOG_POS=503;\n</code></pre><p>启动slave,IO和SQL为Yes说明启动成功</p>\n<pre><code>START SLAVE;\nSHOW SLAVE STATUS\\G\nSlave_IO_Running: Yes\nSlave_SQL_Running: Yes\n</code></pre><p> <strong>复制时需要注意的地方：</strong></p>\n<ol>\n<li><p>从服务应该设定为只读<br>在从服务器启动read_only,但对非SUPER权限的用户有效；</p>\n<pre><code>show global variables like &quot;%read_only%&quot;;    \nMariaDB [(none)]&gt; SET @@GLOBAL.read_only=ON;\n</code></pre><pre><code>阻止所有用户\n</code></pre><pre><code>MariaDB [(none)]&gt; FLUSH TABLES WITH READ LOCK;\nQuery OK, 0 rows affected (0.00 sec)\n</code></pre></li>\n<li><p>尽量确保复制时的事务安全<br>在master节点启用参数</p>\n<pre><code>MariaDB [(none)]&gt; set @@global.sync_binlog=1;\n</code></pre><p>如果是Innodb存储引擎,确保下面两项是on状态</p>\n<pre><code>  MariaDB [(none)]&gt; show variables like &#39;innodb%trx%&#39;;\n  +-------------------------------------------+-------+\n  | Variable_name                             | Value |\n  +-------------------------------------------+-------+\n  | innodb_flush_log_at_trx_commit            | 1     |\n  | innodb_use_global_flush_log_at_trx_commit | ON    |\n  +-------------------------------------------+-------+\n</code></pre></li>\n<li>从服务器意外终止时尽量避免自动启动复制线程</li>\n<li><p>从节点：设置参数</p>\n<pre><code>MariaDB [(none)]&gt; set @@global.sync_master_info=1;\nMariaDB [(none)]&gt; set @@global.sync_master_info=ON\n</code></pre><p>​</p>\n</li>\n</ol>\n","categories":[],"tags":[{"name":"Mariadb","path":"api/tags/Mariadb.json"},{"name":"主从复制","path":"api/tags/主从复制.json"}]}