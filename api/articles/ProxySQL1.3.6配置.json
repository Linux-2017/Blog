{"title":"ProxySQL1.3.6配置","slug":"ProxySQL1.3.6配置","date":"2017-06-12T13:28:08.000Z","updated":"2017-11-19T13:15:37.000Z","comments":true,"excerpt":"","content":"<h3 id=\"ProxySQL1-3-6配置\"><a href=\"#ProxySQL1-3-6配置\" class=\"headerlink\" title=\"ProxySQL1.3.6配置\"></a>ProxySQL1.3.6配置</h3><p><strong>下载</strong><br><a href=\"https://github.com/sysown/proxysql/releases\" target=\"_blank\" rel=\"noopener\">https://github.com/sysown/proxysql/releases</a></p>\n<h4 id=\"ProxySQL配置\"><a href=\"#ProxySQL配置\" class=\"headerlink\" title=\"ProxySQL配置\"></a>ProxySQL配置</h4><pre><code>[root@171 ~]# cat /etc/proxysql.cnf | grep -E -v &quot;^(#|$)&quot;\ndatadir=&quot;/var/lib/proxysql&quot;\nadmin_variables=\n{\n    admin_credentials=&quot;admin:admin&quot;\n    mysql_ifaces=&quot;127.0.0.1:6032;/tmp/proxysql_admin.sock&quot;\n}\nmysql_variables=\n{\n    threads=4\n    max_connections=2048\n    default_query_delay=0\n    default_query_timeout=36000000\n    have_compress=true\n    poll_timeout=2000\n    interfaces=&quot;0.0.0.0:3306;/tmp/mysql.sock&quot;\n    default_schema=&quot;information_schema&quot;\n    stacksize=1048576\n    server_version=&quot;5.5.30&quot;\n    connect_timeout_server=3000\n    monitor_history=600000\n    monitor_connect_interval=60000\n    monitor_ping_interval=10000\n    monitor_read_only_interval=1500\n    monitor_read_only_timeout=500\n    ping_interval_server=120000\n    ping_timeout_server=500\n    commands_stats=true\n    sessions_sort=true\n    connect_retries_on_failure=10\n}\nmysql_servers =\n(\n    {\n        address = &quot;172.18.50.71&quot; # no default, required . If port is 0 , address is interpred as a Unix Socket Domain\n        port = 3306           # no default, required . If port is 0 , address is interpred as a Unix Socket Domain\n        hostgroup = 0            # no default, required\n        status = &quot;ONLINE&quot;     # default: ONLINE\n        weight = 1            # default: 1\n        compression = 0       # default: 0\n    },\n    {\n        address = &quot;172.18.50.72&quot;\n        port = 3306\n        hostgroup = 1\n        status = &quot;ONLINE&quot;\n        weight = 1       \n        compression = 0  \n    },\n    {\n        address = &quot;172.18.50.73&quot;\n        port = 3306\n        hostgroup = 1\n        status = &quot;ONLINE&quot;\n        weight = 1   \n        compression = 0  \n    }\n)\nmysql_users:\n(\n    {\n        username = &quot;root&quot;\n        password = &quot;rootpw&quot;\n        default_hostgroup = 0\n        max_connections=1000\n        default_schema=&quot;mytest&quot;\n        active = 1\n    },\n    {\n        username = &quot;root&quot;\n        password = &quot;rootpw&quot;\n        default_hostgroup = 1\n        max_connections=1000\n        default_schema=&quot;mytest&quot;\n        active = 1\n    }\n)\nmysql_query_rules:\n(\n)\nscheduler=\n(\n)\nmysql_replication_hostgroups=\n(\n        {\n                writer_hostgroup=0\n                reader_hostgroup=1\n       }\n)\n</code></pre><p>MASTER</p>\n<pre><code>#授权\ngrant all on *.*  to  root@&#39;proxysql ip&#39; identified by &#39;rootpw&#39;;\n</code></pre><p>MASTER授权从服务器会同步授权<br>测试<br>分别在两台从服务器添加不同的表,并测试</p>\n<pre><code>[root@171 ~]# mysql -uroot -prootpw -h172.18.50.170 -e &quot;select * from mytest.t1&quot;;\n+--------+\n| name   |\n+--------+\n| slave2 |\n+--------+\n[root@171 ~]# mysql -uroot -prootpw -h172.18.50.170 -e &quot;select * from mytest.t1&quot;;\n+-------+\n| name  |\n+-------+\n| slave |\n+-------+\n[root@171 ~]# mysql -uroot -prootpw -h172.18.50.170 -e &quot;select * from mytest.t1&quot;;\n</code></pre>","categories":[],"tags":[{"name":"ProxySQL","path":"api/tags/ProxySQL.json"},{"name":"中间件","path":"api/tags/中间件.json"}]}